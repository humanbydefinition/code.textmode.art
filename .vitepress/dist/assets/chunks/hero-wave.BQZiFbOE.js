var as=Object.defineProperty,cs=(o,t,s)=>t in o?as(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s,a=(o,t,s)=>cs(o,typeof t!="symbol"?t+"":t,s);class z extends Error{constructor(t,s={}){super(z.i(t,s)),this.name="TextmodeError"}static i(t,s){return`${t}${s&&Object.keys(s).length>0?`

ðŸ“‹ Context:`+Object.entries(s).map(([e,r])=>`
  - ${e}: ${z.o(r)}`).join(""):""}

${"â†“".repeat(24)}
`}static o(t){if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string")return`"${t}"`;if(typeof t=="number"||typeof t=="boolean")return t+"";if(Array.isArray(t))return t.length===0?"[]":t.length<=5?`[${t.map(s=>z.o(s)).join(", ")}]`:`[${t.slice(0,3).map(s=>z.o(s)).join(", ")}, ... +${t.length-3} more]`;if(typeof t=="object"){const s=Object.keys(t);return s.length===0?"{}":s.length<=3?`{ ${s.map(e=>`${e}: ${z.o(t[e])}`).join(", ")} }`:`{ ${s.slice(0,2).map(e=>`${e}: ${z.o(t[e])}`).join(", ")}, ... +${s.length-2} more }`}return t+""}}var ls=(o=>(o[o.SILENT=0]="SILENT",o[o.WARNING=1]="WARNING",o[o.ERROR=2]="ERROR",o[o.THROW=3]="THROW",o))(ls||{});const Ot=class Q{constructor(){a(this,"l",{globalLevel:3})}static u(){return Q.h||(Q.h=new Q),Q.h}v(t,s){const e="%c[textmode.js] Oops! (â•¯Â°â–¡Â°)â•¯ï¸µ Something went wrong in your code.",r="color: #f44336; font-weight: bold; background: #ffebee; padding: 2px 6px; border-radius: 3px;";switch(this.l.globalLevel){case 0:return!1;case 1:return console.group(e,r),console.warn(z.i(t,s)),console.groupEnd(),!1;case 2:return console.group(e,r),console.error(z.i(t,s)),console.groupEnd(),!1;default:throw new z(t,s)}}m(t,s,e){return!!t||(this.v(s,e),!1)}_(t){this.l.globalLevel=t}};a(Ot,"h",null);let us=Ot;const st=us.u();class et{constructor(t,s,e){a(this,"A"),a(this,"C"),a(this,"M",new Map),a(this,"F",new Map),a(this,"$",0),this.A=t,this.C=this.U(s,e),this.P()}P(){const t=this.A.getProgramParameter(this.C,this.A.ACTIVE_UNIFORMS);for(let s=0;s<t;s++){const e=this.A.getActiveUniform(this.C,s);if(e){const r=e.name.replace(/\[0\]$/,""),i=this.A.getUniformLocation(this.C,r);i&&(this.M.set(r,i),this.F.set(r,{type:e.type,size:e.size}))}}}U(t,s){const e=this.R(this.A.VERTEX_SHADER,t),r=this.R(this.A.FRAGMENT_SHADER,s),i=this.A.createProgram();if(this.A.attachShader(i,e),this.A.attachShader(i,r),this.A.linkProgram(i),!this.A.getProgramParameter(i,this.A.LINK_STATUS)){const h=this.A.getProgramInfoLog(i);throw Error("Shader program link error: "+h)}return this.A.deleteShader(e),this.A.deleteShader(r),i}R(t,s){const e=this.A.createShader(t);if(this.A.shaderSource(e,s),this.A.compileShader(e),!this.A.getShaderParameter(e,this.A.COMPILE_STATUS)){const r=this.A.getShaderInfoLog(e);throw this.A.deleteShader(e),Error("Shader compilation error: "+r)}return e}S(){this.A.useProgram(this.C),this.k()}k(){this.$=0}I(t){for(const s in t)this.O(s,t[s])}O(t,s){var e,r;const i=this.M.get(t);if(!i)return;const h=this.F.get(t);if(!h)return;const{type:n,size:l}=h,c=this.A;if(s instanceof WebGLTexture){const u=this.$++;return c.uniform1i(i,u),c.activeTexture(c.TEXTURE0+u),void c.bindTexture(c.TEXTURE_2D,s)}if(s instanceof Yt){const u=this.$++;return c.uniform1i(i,u),c.activeTexture(c.TEXTURE0+u),void c.bindTexture(c.TEXTURE_2D,s.textures[0])}if(typeof s=="number")return void(n===c.INT||n===c.BOOL?c.uniform1i(i,s):c.uniform1f(i,s));if(typeof s=="boolean")return void c.uniform1i(i,s?1:0);if(Array.isArray(s[0])){const u=s.flat(),d={[c.FLOAT_VEC2]:()=>c.uniform2fv(i,u),[c.FLOAT_VEC3]:()=>c.uniform3fv(i,u),[c.FLOAT_VEC4]:()=>c.uniform4fv(i,u)};(e=d[n])==null||e.call(d)}else{const u=s,d={[c.FLOAT]:()=>l>1?c.uniform1fv(i,u):c.uniform1f(i,u[0]),[c.FLOAT_VEC2]:()=>c.uniform2fv(i,u),[c.FLOAT_VEC3]:()=>c.uniform3fv(i,u),[c.FLOAT_VEC4]:()=>c.uniform4fv(i,u),[c.INT]:()=>l>1?c.uniform1iv(i,u):c.uniform1i(i,u[0]),[c.INT_VEC2]:()=>c.uniform2iv(i,u),[c.INT_VEC3]:()=>c.uniform3iv(i,u),[c.INT_VEC4]:()=>c.uniform4iv(i,u),[c.BOOL]:()=>c.uniform1iv(i,u),[c.FLOAT_MAT2]:()=>c.uniformMatrix2fv(i,!1,u),[c.FLOAT_MAT3]:()=>c.uniformMatrix3fv(i,!1,u),[c.FLOAT_MAT4]:()=>c.uniformMatrix4fv(i,!1,u)};(r=d[n])==null||r.call(d)}}get L(){return this.C}D(){this.A.deleteProgram(this.C)}}function Lt(o,t,s,e){return 180*Math.atan2(e-t,s-o)/Math.PI}function V(o,t,s,e){return Math.hypot(s-o,e-t)}function St(o){return(o%360+360)%360/360}function _t(o,t,s){o.bindTexture(o.TEXTURE_2D,t),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s),o.bindTexture(o.TEXTURE_2D,null)}function ct(o,t,s,e,r){o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r)}function Ct(o,t,s,e,r,i=0,h=WebGL2RenderingContext.FLOAT,n=!1){o.enableVertexAttribArray(t),o.vertexAttribPointer(t,s,h,n,e,r),o.vertexAttribDivisor(t,i)}function Gt(o,t,s,e,r){o.bindBuffer(t,s),o.bufferData(t,e,r),o.bindBuffer(t,null)}const lt=`#version 300 es
in vec2 A0;in vec2 A1;in vec2 A2;in vec2 A3;in vec3 A4;in vec4 A5;in vec4 A6;in vec4 A7;in vec3 A8;in vec3 A9;in vec4 Aa;in vec4 Ab;in vec3 Ac;uniform vec2 Ut;uniform float Uu;uniform float Uv;out vec2 v_uv;out vec3 v_glyphIndex;out vec4 v_glyphColor;out vec4 v_cellColor;out vec4 v_glyphFlags;out vec3 v_worldPosition;out vec3 v_normal;out float v_geometryType;const float A=6.28318530718f;const int B=2;const int C=3;const int D=4;vec2 E(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float M=L*K;float N=F*F;float O=N*F;return M*G+3.0f*L*F*H+3.0f*K*N*I+O*J;}vec2 P(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float N=F*F;return-3.0f*L*G+3.0f*(L-2.0f*K*F)*H+3.0f*(2.0f*K*F-N)*I+3.0f*N*J;}vec3 Q(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x,R.y*T-R.z*U,R.y*U+R.z*T);}vec3 V(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T+R.z*U,R.y,-R.x*U+R.z*T);}vec3 W(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T-R.y*U,R.x*U+R.y*T,R.z);}vec3 X(vec3 R,vec3 Y){vec3 Z=R;if(Y.z!=0.0f){Z=W(Z,Y.z);}if(Y.y!=0.0f){Z=V(Z,Y.y);}if(Y.x!=0.0f){Z=Q(Z,Y.x);}return Z;}void main(){v_uv=A1;v_glyphIndex=A4;v_glyphColor=A5;v_cellColor=A6;v_glyphFlags=A7;vec4 a=Aa;vec4 b=Ab;vec2 c=A3;vec2 d=A2;float e=Ac.x;float f=Ac.y;int g=int(Ac.z);vec2 h=d;vec2 i=h+c*0.5f;float j=f+e*0.5f;vec3 k=vec3(i,j);vec3 l;if(g==D){float F=clamp(A0.x,0.0f,1.0f);vec2 G=b.xy;vec2 H=a.xy;vec2 I=a.zw;vec2 J=b.zw;vec2 m=E(F,G,H,I,J);vec2 n=P(F,G,H,I,J);float o=length(n);vec2 p=o>0.0f?n/o:vec2(1.0f,0.0f);vec2 q=vec2(-p.y,p.x);vec2 r=m;vec2 s=r+q*A0.y*c.y;l=vec3(s,f);}else if(g==C){float t=mod(a.x,A);if(t<0.0f){t+=A;}float u=mod(a.y,A);if(u<0.0f){u+=A;}float v=t-u;if(v<=0.0f){v+=A;}float S=t-A0.x*v;vec2 w=vec2(cos(S),sin(S))*A0.y;vec2 s=w*c+h;l=vec3(s,f);}else if(g==B){vec2 s=A0.xy*c+h;l=vec3(s,f);}vec3 x=X(l,A9);vec3 y=x+A8;vec3 z=vec3(0.0f,0.0f,1.0f);v_worldPosition=y;v_normal=z;v_geometryType=float(g);vec2 AA=(y.xy/Ut)*2.0f;AA.y=-AA.y;float AB=y.z/Ut.y;float AC=clamp(-AB*Uu,-0.99f,0.99f);if(Uv>0.5f){gl_Position=vec4(AA,AC,1.0f);}else{float AD=0.5f;float AE=1.0f/(1.0f-AB*AD);AA*=AE;gl_Position=vec4(AA,AC,1.0f);}}`,Xt=class nt{constructor(t,s,e=s,r=1,i={},h){a(this,"H"),a(this,"G"),a(this,"l"),a(this,"A"),a(this,"N"),a(this,"X",[]),a(this,"Y",null),a(this,"K"),a(this,"j"),a(this,"Z",null),a(this,"W",new Map);var n;this.H=s,this.G=e,this.A=t,this.K=(n=8,Math.min(Math.max(r,1),n)),this.j=h,this.l={filter:"nearest",wrap:"clamp",format:"rgba",type:"unsigned_byte",depth:!0,...i},nt.q||(nt.q=new et(t,lt,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D Uc;uniform sampler2D Ud;uniform sampler2D Ue;uniform vec2 Uf;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){vec2 A=vec2(v_uv.x,1.-v_uv.y);vec2 B=A*Uf;vec2 C=(floor(B)+0.5f)/Uf;vec4 D=texture(Uc,C);vec4 E=texture(Ud,C);if(E.a==0.){discard;}vec4 F=texture(Ue,C);o_character=D;o_primaryColor=E;o_secondaryColor=F;}`));const l=t.getParameter(t.MAX_DRAW_BUFFERS),c=t.getParameter(t.MAX_COLOR_ATTACHMENTS);this.K=Math.min(this.K,l,c),this.N=t.createFramebuffer(),this.V(),this.J(),this.l.depth&&this.tt()}V(){const t=this.A,s=this.l.filter==="linear"?t.LINEAR:t.NEAREST,e=this.l.wrap==="repeat"?t.REPEAT:t.CLAMP_TO_EDGE,r=this.l.type==="float"?t.FLOAT:t.UNSIGNED_BYTE,i=r===t.FLOAT?t.RGBA32F:t.RGBA8,h=t.RGBA;for(let n=0;n<this.K;n++){const l=t.createTexture();t.bindTexture(t.TEXTURE_2D,l),ct(t,s,s,e,e),t.texImage2D(t.TEXTURE_2D,0,i,this.H,this.G,0,h,r,null),this.X.push(l)}t.bindTexture(t.TEXTURE_2D,null)}J(){const t=this.A;if(t.bindFramebuffer(t.FRAMEBUFFER,this.N),this.K===1)t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.X[0],0);else{const s=[];for(let e=0;e<this.K;e++){const r=t.COLOR_ATTACHMENT0+e;t.framebufferTexture2D(t.FRAMEBUFFER,r,t.TEXTURE_2D,this.X[e],0),s.push(r)}t.drawBuffers(s)}t.bindFramebuffer(t.FRAMEBUFFER,null)}tt(){const t=this.A;this.Y=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.Y),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,this.H,this.G),t.bindFramebuffer(t.FRAMEBUFFER,this.N),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.Y),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}st(t){_t(this.A,this.X[0],t)}resize(t,s){this.H=t,this.G=s,this.W.clear();const e=this.A,r=this.l.type==="float"?e.FLOAT:e.UNSIGNED_BYTE,i=r===e.FLOAT?e.RGBA32F:e.RGBA8,h=e.RGBA;for(const n of this.X)e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,i,this.H,this.G,0,h,r,null);e.bindTexture(e.TEXTURE_2D,null),this.Y&&(e.bindRenderbuffer(e.RENDERBUFFER,this.Y),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT24,this.H,this.G),e.bindRenderbuffer(e.RENDERBUFFER,null))}readPixels(t){const s=this.W.get(t);if(s)return s;const e=this.A,r=this.H,i=this.G,h=new Uint8Array(r*i*4),n=e.getParameter(e.READ_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.READ_FRAMEBUFFER,this.N),e.readBuffer(e.COLOR_ATTACHMENT0+t),e.readPixels(0,0,r,i,e.RGBA,e.UNSIGNED_BYTE,h),e.bindFramebuffer(e.READ_FRAMEBUFFER,n);const l=4*r,c=new Uint8Array(h.length);for(let u=0;u<i;u++){const d=(i-1-u)*l,g=u*l;c.set(h.subarray(d,d+l),g)}return this.W.set(t,c),c}begin(){const t=this.A;this.W.clear(),this.j.et(),this.j.it(this.N,this.H,this.G),this.l.depth&&t.clear(t.DEPTH_BUFFER_BIT),this.j.state.rt()}end(){this.j.state.nt(),this.j.ot();const t=this.j.ht();this.j.it(t.framebuffer,t.viewport[2],t.viewport[3])}ct(){return this.Z||this.lt(),this.Z}lt(){if(!this.j)return;const t={Uc:this.X[0],Ud:this.X[1],Ue:this.X[2],Uf:[this.H,this.G]},s=nt.q;this.Z=this.j.ft.ut(s,t,!0)}D(){const t=this.A;t.deleteFramebuffer(this.N);for(const s of this.X)t.deleteTexture(s);this.Y&&t.deleteRenderbuffer(this.Y)}get width(){return this.H}get height(){return this.G}get textures(){return this.X}get attachmentCount(){return this.K}};a(Xt,"q",null);let Yt=Xt;const jt=new WeakMap;function mt(o,t){jt.set(o,t)}function Ht(o){return jt.get(o)}function k(o,t,s,e,r=255){o[0]=t/255,o[1]=(s??t)/255,o[2]=(e??t)/255,o[3]=r/255}class ut{constructor(){a(this,"dt",1),a(this,"gt",0),a(this,"vt",0),a(this,"_t",0),a(this,"At",0),a(this,"yt",0),a(this,"wt",0),a(this,"bt",[0,0,0]),a(this,"Ct",[1,1,1,1]),a(this,"Mt",[0,0,0,1]),a(this,"xt",!1),a(this,"Ft",!1),a(this,"$t",!1),a(this,"Tt",0),a(this,"Pt",[0,0,0,1]),a(this,"Et",!1),a(this,"Rt",[]),a(this,"St",[])}static kt(){return{zt:1,It:0,Ot:0,Lt:0,At:0,yt:0,wt:0,Tt:0,Dt:!1,Bt:!1,$t:!1,Et:!1,Ht:[0,0,0],Gt:[1,1,1,1],Nt:[0,0,0,1]}}Xt(t){t.zt=this.dt,t.It=this.gt,t.Ot=this.vt,t.Lt=this._t,t.At=this.At,t.yt=this.yt,t.wt=this.wt,t.Dt=this.xt,t.Bt=this.Ft,t.$t=this.$t,t.Tt=this.Tt,t.Et=this.Et,t.Ht[0]=this.bt[0],t.Ht[1]=this.bt[1],t.Ht[2]=this.bt[2],t.Gt[0]=this.Ct[0],t.Gt[1]=this.Ct[1],t.Gt[2]=this.Ct[2],t.Gt[3]=this.Ct[3],t.Nt[0]=this.Mt[0],t.Nt[1]=this.Mt[1],t.Nt[2]=this.Mt[2],t.Nt[3]=this.Mt[3]}Yt(t){this.dt=t.zt,this.gt=t.It,this.vt=t.Ot,this._t=t.Lt,this.At=t.At,this.yt=t.yt,this.wt=t.wt,this.xt=t.Dt,this.Ft=t.Bt,this.$t=t.$t,this.Tt=t.Tt,this.Et=t.Et,this.bt[0]=t.Ht[0],this.bt[1]=t.Ht[1],this.bt[2]=t.Ht[2],this.Ct[0]=t.Gt[0],this.Ct[1]=t.Gt[1],this.Ct[2]=t.Gt[2],this.Ct[3]=t.Gt[3],this.Mt[0]=t.Nt[0],this.Mt[1]=t.Nt[1],this.Mt[2]=t.Nt[2],this.Mt[3]=t.Nt[3]}rt(){let t=this.St.pop();t||(t=ut.kt()),this.Xt(t),this.Rt.push(t)}nt(){const t=this.Rt.pop();t?(this.Yt(t),this.St.push(t)):console.warn("pop() called without matching push()")}Kt(t){this.Xt(t)}jt(t){this.dt=Math.abs(t)}Zt(){this.gt=0,this.vt=0,this._t=0,this.At=0,this.yt=0,this.wt=0,this.Et=!1}Wt(t){t!==0&&(this.At+=t*Math.PI/180)}qt(t){t!==0&&(this.yt+=t*Math.PI/180)}Vt(t){t!==0&&(this.wt+=t*Math.PI/180)}Qt(t=0,s=0,e=0){t===0&&s===0&&e===0||(this.gt+=t,this.vt+=s,this._t+=e)}Jt(t){this.Qt(t,0,0)}ts(t){this.Qt(0,t,0)}ss(t){this.Qt(0,0,t)}es(t){this.bt[0]=t[0],this.bt[1]=t[1],this.bt[2]=t[2]}rs(t,s,e,r=255){k(this.Ct,t,s,e,r)}ns(t,s,e,r=255){k(this.Mt,t,s,e,r)}hs(t){this.xt=t}cs(t){this.Ft=t}ls(t){this.$t=t}us(t){this.Tt=St(t)}fs(t,s,e,r){k(this.Pt,t,s,e,r)}ds(t){this.Et=t}get canvasBackgroundColor(){return this.Pt}get useOrtho(){return this.Et}get rotationX(){return this.At}get rotationY(){return this.yt}get rotationZ(){return this.wt}}const Pt=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,-.5,.5,0,1,-.5,.5,0,1,.5,-.5,1,0,.5,.5,1,1]),Z={ps:16,gs:WebGL2RenderingContext.TRIANGLES,vs:{_s:{size:2,offset:0},As:{size:2,offset:8}}};class fs{constructor(t){a(this,"A"),a(this,"ws"),a(this,"bs"),this.A=t,this.ws=t.createBuffer(),this.bs=new Float32Array(Pt.length)}Cs(t,s,e,r){const i=this.A,h=Ht(this.A),n=h[2],l=h[3],c=t/n*2-1,u=(t+e)/n*2-1,d=1-(s+r)/l*2,g=1-s/l*2,f=Pt,m=this.bs;for(let p=0;p<f.length;p+=4){const v=f[p],A=f[p+1],E=f[p+2],y=f[p+3],R=c+(v+.5)*(u-c),b=d+(A+.5)*(g-d);m[p]=R,m[p+1]=b,m[p+2]=E,m[p+3]=y}i.bindBuffer(i.ARRAY_BUFFER,this.ws),i.bufferData(i.ARRAY_BUFFER,m,i.DYNAMIC_DRAW),i.enableVertexAttribArray(0),i.vertexAttribPointer(0,2,i.FLOAT,!1,16,0),i.drawArrays(i.TRIANGLES,0,6),i.disableVertexAttribArray(0),i.bindBuffer(i.ARRAY_BUFFER,null)}D(){this.A.deleteBuffer(this.ws)}}var N=(o=>(o.RECTANGLE="rectangle",o.LINE="line",o.ELLIPSE="ellipse",o.ARC="arc",o.TRIANGLE="triangle",o.BEZIER_CURVE="bezier_curve",o))(N||{});const ds={rectangle:2,line:2,ellipse:2,triangle:2,arc:3,bezier_curve:4};class gs{constructor(t){a(this,"A"),a(this,"Ms",new Map),this.A=t}Fs(t,s,e,r){const i=this.A;let h=this.Ms.get(t);h||(h=new Map,this.Ms.set(t,h));let n=h.get(s)||null;if(!n){n=i.createVertexArray(),h.set(s,n),i.bindVertexArray(n),i.bindBuffer(i.ARRAY_BUFFER,r);const l=i.getAttribLocation(t,"A0");l!==-1&&Ct(i,l,e.vs._s.size,e.ps,e.vs._s.offset,0,i.FLOAT,!1);const c=i.getAttribLocation(t,"A1");c!==-1&&Ct(i,c,e.vs.As.size,e.ps,e.vs.As.offset,0,i.FLOAT,!1)}i.bindVertexArray(n)}$s(){this.A.bindVertexArray(null)}D(){for(const[,t]of this.Ms)for(const[,s]of t)s&&this.A.deleteVertexArray(s)}}const Mt=class ${static Ts(t,s,e=0){const r=s||new Float32Array($.FLOATS_PER_INSTANCE);let i=e;r[i++]=t._s[0],r[i++]=t._s[1],r[i++]=t.Ps[0],r[i++]=t.Ps[1],r[i++]=t.Ht[0],r[i++]=t.Ht[1],r[i++]=t.Ht[2],r[i++]=t.Gt[0],r[i++]=t.Gt[1],r[i++]=t.Gt[2],r[i++]=t.Gt[3],r[i++]=t.Nt[0],r[i++]=t.Nt[1],r[i++]=t.Nt[2],r[i++]=t.Nt[3],r[i++]=t.Es[0],r[i++]=t.Es[1],r[i++]=t.Es[2],r[i++]=t.Tt;const h=t.Rs;r[i++]=(h==null?void 0:h[0])??0,r[i++]=(h==null?void 0:h[1])??0,r[i++]=(h==null?void 0:h[2])??0;const n=t.Ss;r[i++]=(n==null?void 0:n[0])??0,r[i++]=(n==null?void 0:n[1])??0,r[i++]=(n==null?void 0:n[2])??0;const l=t.ks,c=t.zs,u=t.Is,d=t.Os,g=t.Ls,f=!(!c||!u);return f?(r[i++]=(d==null?void 0:d[0])??0,r[i++]=(d==null?void 0:d[1])??0,r[i++]=(g==null?void 0:g[0])??0,r[i++]=(g==null?void 0:g[1])??0,r[i++]=c[0],r[i++]=c[1],r[i++]=u[0],r[i++]=u[1]):!f&&l?(r[i++]=l[0],r[i++]=l[1],r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0):(r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0),r[i++]=t.Ds??0,r[i++]=t.Bs??0,r[i++]=t.Hs??0,r}static Gs(t,s){const e=t.length*$.FLOATS_PER_INSTANCE,r=s||new Float32Array(e);for(let i=0;i<t.length;i++){const h=i*$.FLOATS_PER_INSTANCE;$.Ts(t[i],r,h)}return r}};a(Mt,"BYTES_PER_INSTANCE",144),a(Mt,"FLOATS_PER_INSTANCE",36);let S=Mt;const D=class{};a(D,"STRIDE",S.BYTES_PER_INSTANCE),a(D,"ATTRIBUTES",{A2:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:0,divisor:1},A3:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:8,divisor:1},A4:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:16,divisor:1},A5:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:28,divisor:1},A6:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:44,divisor:1},A7:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:60,divisor:1},A8:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:76,divisor:1},A9:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:88,divisor:1},Aa:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:100,divisor:1},Ab:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:116,divisor:1},Ac:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:D.STRIDE,offset:132,divisor:1}});let vt=D;class ps{constructor(t=1e3,s=1.5){a(this,"Ns"),a(this,"Xs"),a(this,"Ys"),a(this,"Ks",0),a(this,"js",0),this.Xs=t,this.Ys=s;const e=t*S.FLOATS_PER_INSTANCE;this.Ns=new Float32Array(e)}Zs(t){if(t<=this.Xs)return;const s=Math.ceil(t*this.Ys),e=this.Xs;this.Xs=s;const r=s*S.FLOATS_PER_INSTANCE,i=new Float32Array(r),h=e*S.FLOATS_PER_INSTANCE;i.set(this.Ns.subarray(0,Math.min(h,this.Ks))),this.Ns=i}Ws(){return{buffer:this.Ns,offset:this.Ks}}qs(t){this.Ks+=t,this.js++}Vs(){this.Ks=0,this.js=0}Qs(t=0,s){return this.Ns.subarray(t,s??this.Ks)}get Js(){return this.js}get te(){return this.Xs}get se(){return this.Ks}get ee(){return this.js===0}}class As{constructor(t){a(this,"Ns"),this.Ns=t}ie(t){this.Ns.Zs(this.Ns.Js+1);const{buffer:s,offset:e}=this.Ns.Ws();s[e+0]=t.x,s[e+1]=t.y,s[e+2]=t.width,s[e+3]=t.height,s[e+4]=t.char0,s[e+5]=t.char1,s[e+6]=t.char2,s[e+7]=t.r1,s[e+8]=t.g1,s[e+9]=t.b1,s[e+10]=t.a1,s[e+11]=t.r2,s[e+12]=t.g2,s[e+13]=t.b2,s[e+14]=t.a2,s[e+15]=t.invert,s[e+16]=t.flipX,s[e+17]=t.flipY,s[e+18]=t.charRot,s[e+19]=t.translationX,s[e+20]=t.translationY,s[e+21]=t.translationZ,s[e+22]=t.rotationX,s[e+23]=t.rotationY,s[e+24]=t.rotationZ;const r=t.curveParams0,i=t.curveParams1;return s[e+25]=r[0],s[e+26]=r[1],s[e+27]=r[2],s[e+28]=r[3],s[e+29]=i[0],s[e+30]=i[1],s[e+31]=i[2],s[e+32]=i[3],s[e+33]=t.depth,s[e+34]=t.baseZ,s[e+35]=t.geometryType,this.Ns.qs(S.FLOATS_PER_INSTANCE),this.Ns.Js-1}get Js(){return this.Ns.Js}}class ms{constructor(t,s=1e3){a(this,"A"),a(this,"re",null),a(this,"ne",0),a(this,"oe",new Map),this.A=t,this.he(s)}he(t){const s=this.A;this.re&&s.deleteBuffer(this.re),this.re=s.createBuffer();const e=t*S.BYTES_PER_INSTANCE;Gt(s,s.ARRAY_BUFFER,this.re,e,s.DYNAMIC_DRAW),this.ne=t}ae(t){this.he(t)}get te(){return this.ne}ce(t,s){if(s===0)return;const e=this.A;e.bindBuffer(e.ARRAY_BUFFER,this.re);const r=s*S.FLOATS_PER_INSTANCE;e.bufferSubData(e.ARRAY_BUFFER,0,t,0,r)}le(t){let s=this.oe.get(t);if(!s){s=new Map;const e=this.A;for(const r in vt.ATTRIBUTES){const i=e.getAttribLocation(t,r);i!==-1&&s.set(r,i)}this.oe.set(t,s)}return s}ue(t){const s=this.A,e=t.L,r=this.le(e);for(const[i,h]of r){const n=vt.ATTRIBUTES[i];n&&Ct(s,h,n.size,n.stride,n.offset,n.divisor,n.type,n.normalized)}}fe(t){const s=this.A,e=this.le(t.L);for(const[r,i]of e)vt.ATTRIBUTES[r]&&(s.disableVertexAttribArray(i),s.vertexAttribDivisor(i,0))}D(){this.re&&(this.A.deleteBuffer(this.re),this.re=null),this.oe.clear()}}class vs{constructor(t,s=1e3,e=1.5){a(this,"A"),a(this,"Ns"),a(this,"de"),a(this,"pe"),this.A=t,this.Ns=new ps(s,e),this.de=new As(this.Ns),this.pe=new ms(t,s)}ge(t){var s,e,r,i,h,n,l,c,u,d;const g=[0,0,0,0],f=[0,0,0,0];return t.zs&&t.Is?(g[0]=((s=t.Os)==null?void 0:s[0])??0,g[1]=((e=t.Os)==null?void 0:e[1])??0,g[2]=((r=t.Ls)==null?void 0:r[0])??0,g[3]=((i=t.Ls)==null?void 0:i[1])??0,f[0]=t.zs[0],f[1]=t.zs[1],f[2]=t.Is[0],f[3]=t.Is[1]):t.ks&&(g[0]=t.ks[0],g[1]=t.ks[1]),this.ie({x:t._s[0],y:t._s[1],width:t.Ps[0],height:t.Ps[1],char0:t.Ht[0],char1:t.Ht[1],char2:t.Ht[2],r1:t.Gt[0],g1:t.Gt[1],b1:t.Gt[2],a1:t.Gt[3],r2:t.Nt[0],g2:t.Nt[1],b2:t.Nt[2],a2:t.Nt[3],invert:t.Es[0],flipX:t.Es[1],flipY:t.Es[2],charRot:t.Tt,translationX:((h=t.Rs)==null?void 0:h[0])??0,translationY:((n=t.Rs)==null?void 0:n[1])??0,translationZ:((l=t.Rs)==null?void 0:l[2])??0,rotationX:((c=t.Ss)==null?void 0:c[0])??0,rotationY:((u=t.Ss)==null?void 0:u[1])??0,rotationZ:((d=t.Ss)==null?void 0:d[2])??0,curveParams0:g,curveParams1:f,depth:t.Ds||0,baseZ:t.Bs||0,geometryType:t.Hs||0})}ie(t){const s=this.de.ie(t);return this.Ns.te>this.pe.te&&this.pe.ae(this.Ns.te),s}get ve(){return this.Ns.Js}get ee(){return this.Ns.ee}me(){this.Ns.Vs()}ue(t){const s=this.Ns.Js;if(s===0)return;const e=this.Ns.Qs();this.pe.ce(e,s),this.pe.ue(t)}fe(t){this.pe.fe(t)}Cs(t,s){const e=this.Ns.Js;e!==0&&this.A.drawArraysInstanced(t,0,s,e)}D(){this.pe.D()}}class G{constructor(t,s,e,r){a(this,"A"),a(this,"_e"),a(this,"Ae"),a(this,"ye"),a(this,"we",null),this.A=t,this._e=s,this.Ae=e,this.ye=r;const i=this.A.createBuffer();Gt(this.A,this.A.ARRAY_BUFFER,i,this.ye.be,this.A.STATIC_DRAW),this.we=i}get type(){return this.Ae}get unitGeometry(){return this.ye}get unitBuffer(){return this.we}get batch(){return this._e}Ce(){this._e.me()}Me(){return!this._e.ee}D(){this._e.D(),this.A.deleteBuffer(this.we)}xe(t,s,e){return this._e.ge(t)}Fe(t,s,e,r,i,h){const n=i.It??0,l=i.Ot??0,c=i.Lt??0,u=i.At??0,d=i.yt??0,g=i.wt??0,f=[0,0,0,0],m=[0,0,0,0];h&&(h.bezStartX!==void 0&&h.bezStartY!==void 0&&h.bezEndX!==void 0&&h.bezEndY!==void 0?(f[0]=h.cp1x??0,f[1]=h.cp1y??0,f[2]=h.cp2x??0,f[3]=h.cp2y??0,m[0]=h.bezStartX??0,m[1]=h.bezStartY??0,m[2]=h.bezEndX??0,m[3]=h.bezEndY??0):h.arcStart===void 0&&h.arcStop===void 0||(f[0]=h.arcStart??0,f[1]=h.arcStop??0));const p={x:t,y:s,width:e,height:r,char0:i.Ht[0],char1:i.Ht[1],char2:i.Ht[2],r1:i.Gt[0],g1:i.Gt[1],b1:i.Gt[2],a1:i.Gt[3],r2:i.Nt[0],g2:i.Nt[1],b2:i.Nt[2],a2:i.Nt[3],invert:i.$t?1:0,flipX:i.Dt?1:0,flipY:i.Bt?1:0,charRot:i.Tt,translationX:n,translationY:l,translationZ:c,rotationX:u,rotationY:d,rotationZ:g,curveParams0:f,curveParams1:m,depth:(h==null?void 0:h.depth)??0,baseZ:(h==null?void 0:h.baseZ)??0,geometryType:ds[this.Ae]??0};return this._e.ie(p)}}const ys={be:Pt,$e:6,...Z},Es={be:new Float32Array([0,-.5,0,0,1,-.5,1,0,0,.5,0,1,0,.5,0,1,1,-.5,1,0,1,.5,1,1]),$e:6,...Z},ws={be:function(o=32){const t=[],s=2*Math.PI/o;for(let e=0;e<o;e++){const r=e*s,i=(e+1)%o*s,h=Math.cos(r),n=Math.sin(r),l=.5*(h+1),c=.5*(n+1),u=Math.cos(i),d=Math.sin(i),g=.5*(u+1),f=.5*(d+1);t.push(0,0,.5,.5,h,n,l,c,u,d,g,f)}return new Float32Array(t)}(32),$e:96,...Z};let bs={be:function(o){const t=[];for(let s=0;s<o;s++){const e=s/o,r=(s+1)/o;t.push(e,0,e,0,e,1,e,1,r,1,r,1)}return new Float32Array(t)}(32),$e:96,...Z};const Ts={be:new Float32Array([0,0,0,0,1,0,1,0,.5,1,.5,1]),$e:3,...Z},xs={be:function(o=16){const t=[];for(let s=0;s<o;s++){const e=s/o,r=(s+1)/o;t.push(e,-.5,e,0,r,-.5,r,0,e,.5,e,1,e,.5,e,1,r,-.5,r,0,r,.5,r,1)}return new Float32Array(t)}(16),$e:96,...Z},Rs={[N.RECTANGLE]:class extends G{constructor(o,t){super(o,t,N.RECTANGLE,ys)}ge(o,t){return this.Fe(0,0,o.width,o.height,t)}},[N.LINE]:class extends G{constructor(o,t){super(o,t,N.LINE,Es)}ge(o,t){const s=o.x2-o.x1,e=o.y2-o.y1,r=Math.hypot(s,e),i=Math.atan2(e,s),h=t.zt||1,n=o.x1+s/2-r/2,l=o.y1+e/2,c={...t,wt:(t.wt||0)+i};return this.Fe(n,l,r,h,c)}},[N.ELLIPSE]:class extends G{constructor(o,t){super(o,t,N.ELLIPSE,ws)}ge(o,t){return this.Fe(0,0,o.width,o.height,t)}},[N.ARC]:class extends G{constructor(o,t){super(o,t,N.ARC,bs)}ge(o,t){const s=o.start*Math.PI/180,e=o.stop*Math.PI/180;return this.Fe(0,0,o.width,o.height,t,{arcStart:s,arcStop:e})}},[N.TRIANGLE]:class extends G{constructor(o,t){super(o,t,N.TRIANGLE,Ts)}ge(o,t){const s=Math.min(o.x1,o.x2,o.x3),e=Math.max(o.x1,o.x2,o.x3),r=Math.min(o.y1,o.y2,o.y3),i=e-s,h=Math.max(o.y1,o.y2,o.y3)-r;return this.Fe(s,r,i,h,t)}},[N.BEZIER_CURVE]:class extends G{constructor(o,t){super(o,t,N.BEZIER_CURVE,xs)}ge(o,t){return this.Fe(0,0,1,t.zt||1,t,{cp1x:o.cp1x,cp1y:o.cp1y,cp2x:o.cp2x,cp2y:o.cp2y,bezStartX:o.x1,bezStartY:o.y1,bezEndX:o.x2,bezEndY:o.y2})}}};class Cs{constructor(t){a(this,"A"),a(this,"Te"),a(this,"Pe"),this.A=t,this.Pe=new gs(t),this.Te=new Map;for(const s of Object.values(N)){const e=new vs(t),r=new Rs[s](t,e);this.Te.set(s,r)}}Ee(t){const s=this.Re(t);for(const e of s)this.Se(e)}Re(t){const s=[];let e=null,r=null,i=null;for(const h of t)r!==h.material||i!==h.type?(e&&e.length>0&&s.push({material:r,type:i,commands:e}),e=[h],r=h.material,i=h.type):e.push(h);return e&&e.length>0&&s.push({material:r,type:i,commands:e}),s}Se(t){const{material:s,type:e,commands:r}=t,i=this.Te.get(e);s.shader.S(),s.shader.I(s.uniforms);const h=Ht(this.A),n=r.length>0&&r[0].state.Et;s.shader.I({Us:h[2]/h[3],Ut:[h[2],h[3]],Uu:1,Uv:n?1:0}),i.Ce();for(const l of r)i.ge(l.params,l.state);if(i.Me()){const l=i.unitGeometry,c=i.unitBuffer;try{this.Pe.Fs(s.shader.L,e+"",l,c),i.batch.ue(s.shader),i.batch.Cs(l.gs,l.$e)}finally{i.batch.fe(s.shader),this.Pe.$s(),i.Ce()}}}D(){for(const t of this.Te.values())t.D();this.Te.clear(),this.Pe.D()}}function kt(o){let t=0;for(let s=0;s<o.length;s++)t=(t<<5)-t+o.charCodeAt(s),t&=t;return t}function Ut(o){return kt(o+"")}function q(o,t){return(o<<5)-o+t}class Ps{constructor(t){a(this,"A"),a(this,"ke",0),a(this,"ze"),a(this,"Ie"),a(this,"Oe",new Map),this.A=t,this.ze=new et(t,lt,`#version 300 es
precision highp float;in vec3 v_glyphIndex;in vec4 v_glyphColor;in vec4 v_cellColor;in vec4 v_glyphFlags;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){int A=int(v_glyphFlags.r>0.5?1:0);int B=int(v_glyphFlags.g>0.5?1:0);int C=int(v_glyphFlags.b>0.5?1:0);float D=float(A|(B<<1)|(C<<2))/255.;o_character=vec4(v_glyphIndex.xy,D,clamp(v_glyphFlags.a,0.,1.));o_primaryColor=vec4(v_glyphColor.rgb,v_glyphColor.a);o_secondaryColor=vec4(v_cellColor.rgb,v_cellColor.a);}`),this.Ie={id:this.ke++,shader:this.ze,uniforms:Object.freeze({}),hash:this.Le(this.ze,{}),isBuiltIn:!0}}get De(){return this.Ie}ut(t,s={},e=!1){const r=this.Le(t,s),i=this.Oe.get(r);if(i)return i;const h={id:this.ke++,shader:t,uniforms:Object.freeze({...s}),hash:r,isBuiltIn:e};return this.Oe.set(r,h),h}Be(t,s={}){return{id:this.ke++,shader:t,uniforms:Object.freeze({...s}),hash:0,isBuiltIn:!1}}Le(t,s){const e=Ut(t.L),r=function(i,h){let n=0;const l=Object.keys(i).sort();for(const c of l)n=q(n,kt(c)),n=q(n,h(i[c]));return n}(s,this.He.bind(this));return q(e,r)}He(t){return typeof t=="number"||typeof t=="boolean"?function(s){return typeof s=="boolean"?s?1:0:Math.floor(s)}(t):Array.isArray(t)?function(s){let e=0;const r=Array.isArray(s[0])?s.flat():s;for(const i of r)e=q(e,typeof i=="number"?i:0);return e}(t):t instanceof Float32Array||t instanceof Int32Array?function(s){let e=0;const r=Math.min(s.length,16);for(let i=0;i<r;i++)e=q(e,s[i]);return e}(t):t instanceof WebGLTexture?Ut(t):0}D(){this.ze!=this.ze&&this.ze.D(),this.ze.D(),this.Oe.clear()}}class Ms{constructor(){a(this,"Ge",[]),a(this,"Ne",1),a(this,"Ps",0)}Xe(t,s){if(this.Ps>=this.Ge.length){const r={id:this.Ne++,type:t,params:{},state:ut.kt(),material:s};this.Ge.push(r)}const e=this.Ge[this.Ps];return e.id=this.Ne++,e.type=t,e.material=s,this.Ps++,e}Ye(t,s,e){const r=this.Xe(N.RECTANGLE,e),i=r.params;return i.width=t.width,i.height=t.height,s.Kt(r.state),r.id}Ke(t,s,e){const r=this.Xe(N.LINE,e),i=r.params;return i.x1=t.x1,i.y1=t.y1,i.x2=t.x2,i.y2=t.y2,i.thickness=t.thickness,s.Kt(r.state),r.id}je(t,s,e){const r=this.Xe(N.ELLIPSE,e),i=r.params;return i.width=t.width,i.height=t.height,i.startAngle=t.startAngle,i.endAngle=t.endAngle,i.segments=t.segments,s.Kt(r.state),r.id}Ze(t,s,e){const r=this.Xe(N.ARC,e),i=r.params;return i.width=t.width,i.height=t.height,i.start=t.start,i.stop=t.stop,s.Kt(r.state),r.id}We(t,s,e){const r=this.Xe(N.TRIANGLE,e),i=r.params;return i.x1=t.x1,i.y1=t.y1,i.x2=t.x2,i.y2=t.y2,i.x3=t.x3,i.y3=t.y3,s.Kt(r.state),r.id}qe(t,s,e){const r=this.Xe(N.BEZIER_CURVE,e),i=r.params;return i.x1=t.x1,i.y1=t.y1,i.cp1x=t.cp1x,i.cp1y=t.cp1y,i.cp2x=t.cp2x,i.cp2y=t.cp2y,i.x2=t.x2,i.y2=t.y2,i.thickness=t.thickness,i.segments=t.segments,s.Kt(r.state),r.id}me(){this.Ps=0}[Symbol.iterator](){let t=0;const s=this.Ps,e=this.Ge;return{next:()=>t<s?{value:e[t++],done:!1}:{value:void 0,done:!0}}}}class Fs{constructor(t){a(this,"A"),a(this,"Ve",null),a(this,"Qe"),a(this,"ft"),a(this,"Je"),a(this,"ti"),a(this,"si"),a(this,"ei",null),a(this,"ii",{}),a(this,"ri",[]),a(this,"ni",[]),a(this,"oi",null),a(this,"hi",[0,0,0,0]),this.A=t,t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.depthMask(!0),t.disable(t.CULL_FACE),this.Je=new ut,this.ft=new Ps(t),this.ti=new Ms,this.Qe=new Cs(t),this.si=new fs(t);const s=[0,0,t.canvas.width,t.canvas.height];mt(t,s),this.ri.push(null),this.ni.push(s),this.oi=null,this.hi=s}et(){this.ri.push(this.oi),this.ni.push([...this.hi])}ht(){return{framebuffer:this.ri.pop()??null,viewport:this.ni.pop()??[0,0,this.A.canvas.width,this.A.canvas.height]}}it(t,s,e){const r=this.A;this.oi!==t&&(r.bindFramebuffer(r.FRAMEBUFFER,t),this.oi=t);const i=[0,0,s,e];this.hi[0]===i[0]&&this.hi[1]===i[1]&&this.hi[2]===i[2]&&this.hi[3]===i[3]||(r.viewport(...i),mt(r,i),this.hi=i)}ai(t){this.Ve!==t&&(this.Ve=t,t.S())}ci(t,s){return new et(this.A,t,s)}li(t){this.ei=t,t&&(this.ii={})}O(t,s){this.ii[t]=s}ui(t){Object.assign(this.ii,t)}fi(t){return new et(this.A,lt,t)}di(t,s,e){this.ti.Ye({width:s??t.width,height:e??t.height},this.Je,t.ct())}pi(t,s,e,r){this.si.Cs(t,s,e,r)}gi(t,s){if(this.ei){const e=this.ft.Be(this.ei,this.ii);this.ti.Ye({width:t,height:s},this.Je,e),this.ei=null,this.ii={}}else this.ti.Ye({width:t,height:s},this.Je,this.ft.De)}mi(t,s,e,r){this.ti.Ke({x1:t,y1:s,x2:e,y2:r},this.Je,this.ft.De)}_i(t,s){this.ti.je({width:t,height:s},this.Je,this.ft.De)}Ai(t,s,e,r,i,h){this.ti.We({x1:t,y1:s,x2:e,y2:r,x3:i,y3:h},this.Je,this.ft.De)}yi(t,s,e,r,i,h,n,l){this.ti.qe({x1:t,y1:s,cp1x:e,cp1y:r,cp2x:i,cp2y:h,x2:n,y2:l},this.Je,this.ft.De)}wi(t,s,e,r){this.ti.Ze({width:t,height:s,start:e,stop:r},this.Je,this.ft.De)}bi(t,s,e=1,r={}){return new Yt(this.A,t,s,e,r,this)}Ci(t,s=t,e=t,r=255){this.Je.fs(t,s??t,e??t,r);const[i,h,n,l]=this.Je.canvasBackgroundColor;this.me(i,h,n,l)}me(t=0,s=0,e=0,r=0){this.A.clearColor(t,s,e,r),this.A.clear(this.A.COLOR_BUFFER_BIT)}Mi(){const t=[0,0,this.A.canvas.width,this.A.canvas.height];this.A.viewport(...t),mt(this.A,t),this.hi=t,this.ni.length>0&&(this.ni[0]=t)}ot(){const t=this.ti;this.Qe.Ee(t),t.me()}D(){this.ft.D(),this.Qe.D(),this.si.D()}get context(){return this.A}get state(){return this.Je}}const L={readShort:(o,t)=>(L.t.uint16[0]=o[t]<<8|o[t+1],L.t.int16[0]),readUshort:(o,t)=>o[t]<<8|o[t+1],readUshorts(o,t,s){const e=[];for(let r=0;r<s;r++)e.push(L.readUshort(o,t+2*r));return e},readUint(o,t){const s=L.t.uint8;return s[3]=o[t],s[2]=o[t+1],s[1]=o[t+2],s[0]=o[t+3],L.t.uint32[0]},readASCII(o,t,s){let e="";for(let r=0;r<s;r++)e+=String.fromCharCode(o[t+r]);return e},t:(()=>{const o=new ArrayBuffer(8);return{uint8:new Uint8Array(o),int16:new Int16Array(o),uint16:new Uint16Array(o),uint32:new Uint32Array(o)}})()};function it(o){return o+3&-4}function rt(o,t,s){o[t]=s>>>8&255,o[t+1]=255&s}function O(o,t,s){o[t]=s>>>24&255,o[t+1]=s>>>16&255,o[t+2]=s>>>8&255,o[t+3]=255&s}function Ns(o,t,s){for(let e=0;e<s.length;e++)o[t+e]=255&s.charCodeAt(e)}function yt(o,t,s){const e=t+s;let r=0;const i=L.t;for(let h=t;h<e;h+=4)i.uint8[3]=o[h]||0,i.uint8[2]=o[h+1]||0,i.uint8[1]=o[h+2]||0,i.uint8[0]=o[h+3]||0,r=r+(i.uint32[0]>>>0)>>>0;return r>>>0}class Is{constructor(t){a(this,"b"),a(this,"p",0),a(this,"bitbuf",0),a(this,"bitcnt",0),this.b=t}readBits(t){for(;this.bitcnt<t;){const e=this.b[this.p++]||0;this.bitbuf|=e<<this.bitcnt,this.bitcnt+=8}const s=this.bitbuf&(1<<t)-1;return this.bitbuf>>>=t,this.bitcnt-=t,s}alignToByte(){this.bitbuf=0,this.bitcnt=0}get offset(){return this.p}}function J(o){let t=32,s=0;for(const n of o)n&&(n<t&&(t=n),n>s&&(s=n));if(s===0)return{min:0,max:0,table:new Map};const e=new Uint32Array(s+1);for(const n of o)n&&e[n]++;const r=new Uint32Array(s+1);let i=0;e[0]=0;for(let n=1;n<=s;n++)i=i+e[n-1]<<1,r[n]=i;const h=new Map;for(let n=0;n<o.length;n++){const l=o[n];if(!l)continue;const c=r[l]++;let u=h.get(l);u||(u=[],h.set(l,u)),u[Ls(c,l)]=n}return{min:t,max:s,table:h}}function Et(o,t){let s=0;for(let e=1;e<=t.max;e++){s|=o.readBits(1)<<e-1;const r=t.table.get(e);if(r&&s<r.length){const i=r[s];if(i!==void 0)return i}}throw Error("Invalid Huffman code")}function Ls(o,t){let s=0;for(let e=0;e<t;e++)s=s<<1|1&o,o>>>=1;return s>>>0}function Us(o){if(o.length<2)throw Error("ZLIB data too short");const t=o[0],s=o[1];if((15&t)!=8)throw Error("Unsupported ZLIB compression method");if(((t<<8)+s)%31!=0)throw Error("Bad ZLIB header check");let e=2;32&s&&(e+=4);const r=[];return function(i,h){const n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];let d=0;for(;!d;){d=i.readBits(1);const g=i.readBits(2);if(g===0){i.alignToByte();const f=i.readBits(16);if((65535&(65535^f))!==i.readBits(16))throw Error("DEFLATE uncompressed LEN/NLEN mismatch");for(let m=0;m<f;m++)h.push(i.readBits(8))}else{if(g!==1&&g!==2)throw Error("Unsupported DEFLATE type");{let f,m;if(g===1){const p=Array(288).fill(0);for(let v=0;v<=143;v++)p[v]=8;for(let v=144;v<=255;v++)p[v]=9;for(let v=256;v<=279;v++)p[v]=7;for(let v=280;v<=287;v++)p[v]=8;f=J(p),m=J(Array(32).fill(5))}else{const p=i.readBits(5)+257,v=i.readBits(5)+1,A=i.readBits(4)+4,E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],y=Array(19).fill(0);for(let x=0;x<A;x++)y[E[x]]=i.readBits(3);const R=J(y),b=[];for(;b.length<p+v;){const x=Et(i,R);if(x<=15)b.push(x);else if(x===16){const I=i.readBits(2)+3,M=b[b.length-1]||0;for(let w=0;w<I;w++)b.push(M)}else if(x===17){const I=i.readBits(3)+3;for(let M=0;M<I;M++)b.push(0)}else{if(x!==18)throw Error("Invalid code length symbol");{const I=i.readBits(7)+11;for(let M=0;M<I;M++)b.push(0)}}}const T=b.slice(0,p),P=b.slice(p,p+v);f=J(T),m=J(P)}for(;;){const p=Et(i,f);if(p<256)h.push(p);else{if(p===256)break;if(p>256&&p<286){const v=p-257;let A=n[v];const E=l[v];E&&(A+=i.readBits(E));const y=Et(i,m);if(y>=30)throw Error("Invalid distance symbol");let R=c[y];const b=u[y];b&&(R+=i.readBits(b));const T=h.length-R;if(T<0)throw Error("Invalid distance");for(let P=0;P<A;P++)h.push(h[T+P]||0)}else if(p===286||p===287)throw Error("Reserved length symbol")}}}}}}(new Is(o.subarray(e)),r),new Uint8Array(r)}function Ds(o){const t=L,s=new Uint8Array(o);if(t.readASCII(s,0,4)!=="wOFF")throw Error("Invalid WOFF signature");const e=t.readUint(s,4),r=t.readUshort(s,12),i=t.readUint(s,16),h=[];let n=44;for(let A=0;A<r;A++){const E=t.readASCII(s,n,4),y=t.readUint(s,n+4),R=t.readUint(s,n+8),b=t.readUint(s,n+12),T=t.readUint(s,n+16);h.push({tag:E,offset:y,compLength:R,origLength:b,checksum:T}),n+=20}for(const A of h){const E=new Uint8Array(s.buffer,A.offset,A.compLength);if(A.compLength===A.origLength)A.data=new Uint8Array(E);else if(A.data=Us(E),A.data.length!==A.origLength)if(A.data.length<A.origLength){const y=new Uint8Array(A.origLength);y.set(A.data),A.data=y}else A.data=A.data.subarray(0,A.origLength)}const l=r;let c=1,u=0;for(;c<<1<=l;)c<<=1,u++;const d=16*c,g=16*l-d;let f=12+16*l;const m={};for(const A of h)m[A.tag]=f,f=it(f+A.data.length);const p=new Uint8Array(Math.max(i||0,f));O(p,0,e),rt(p,4,l),rt(p,6,d),rt(p,8,u),rt(p,10,g);let v=12;for(const A of h){Ns(p,v,A.tag),v+=4;let E=A.data;if(A.tag==="head"&&E.length>=12){const y=new Uint8Array(E);O(y,8,0),O(p,v,yt(y,0,it(y.length))),v+=4}else O(p,v,yt(E,0,it(E.length))),v+=4;O(p,v,m[A.tag]),v+=4,O(p,v,A.data.length),v+=4}for(const A of h){const E=m[A.tag];p.set(A.data,E)}if(h.find(A=>A.tag==="head")){const A=m.head,E=function(y,R){const b=R+8,T=[y[b],y[b+1],y[b+2],y[b+3]];O(y,b,0);const P=2981146554-(yt(y,0,it(y.length))>>>0)>>>0;return y[b]=T[0],y[b+1]=T[1],y[b+2]=T[2],y[b+3]=T[3],P>>>0}(p,A);O(p,A+8,E)}return p.buffer}const zs={parseTab(o,t,s){const e={tables:[],ids:{},off:t};o=new Uint8Array(o.buffer,t,s),t=0;const r=L,i=r.readUshort,h=i(o,t+=2);t+=2;const n=[];for(let l=0;l<h;l++){const c=i(o,t),u=i(o,t+=2);t+=2;const d=r.readUint(o,t);t+=4;const g=`p${c}e${u}`;let f=n.indexOf(d);if(f===-1){let m;f=e.tables.length,n.push(d);const p=i(o,d);m=p===4?this.parse4(o,d):p===12?this.parse12(o,d):{format:p},e.tables.push(m)}e.ids[g]=f}return e},parse4(o,t){const s=L,e=s.readUshort,r=s.readUshorts,i=t,h=e(o,t+=2);t+=2;const n=e(o,t+=2)>>>1,l={format:4,searchRange:e(o,t+=2),entrySelector:0,rangeShift:0,endCount:[],startCount:[],idDelta:[],idRangeOffset:[],glyphIdArray:[]};t+=2,l.entrySelector=e(o,t),t+=2,l.rangeShift=e(o,t),t+=2,l.endCount=r(o,t,n),t+=2*n,t+=2,l.startCount=r(o,t,n),t+=2*n;for(let c=0;c<n;c++)l.idDelta.push(s.readShort(o,t)),t+=2;return l.idRangeOffset=r(o,t,n),t+=2*n,l.glyphIdArray=r(o,t,i+h-t>>1),l},parse12(o,t){const s=L.readUint;s(o,t+=4),s(o,t+=4);const e=s(o,t+=4);t+=4;const r=new Uint32Array(3*e);for(let i=0;i<3*e;i+=3)r[i]=s(o,t+(i<<2)),r[i+1]=s(o,t+(i<<2)+4),r[i+2]=s(o,t+(i<<2)+8);return{format:12,groups:r}}},Bs={parseTab(o,t,s){const e=L;t+=18;const r=e.readUshort(o,t);t+=2,t+=16;const i=e.readShort(o,t);t+=2;const h=e.readShort(o,t);t+=2;const n=e.readShort(o,t);t+=2;const l=e.readShort(o,t);return t+=2,t+=6,{unitsPerEm:r,xMin:i,yMin:h,xMax:n,yMax:l,indexToLocFormat:e.readShort(o,t)}}},Os={parseTab(o,t,s){const e=L;t+=4;const r=["ascender","descender","lineGap","advanceWidthMax","minLeftSideBearing","minRightSideBearing","xMaxExtent","caretSlopeRise","caretSlopeRun","caretOffset","res0","res1","res2","res3","metricDataFormat","numberOfHMetrics"],i={};for(let h=0;h<r.length;h++){const n=r[h],l=n==="advanceWidthMax"||n==="numberOfHMetrics"?e.readUshort:e.readShort;i[n]=l(o,t+2*h)}return i}},Ss={parseTab(o,t,s,e){const r=L,i=[],h=[],n=e.maxp.numGlyphs,l=e.hhea.numberOfHMetrics;let c=0,u=0,d=0;for(;d<l;)c=r.readUshort(o,t+(d<<2)),u=r.readShort(o,t+(d<<2)+2),i.push(c),h.push(u),d++;for(;d<n;)i.push(c),h.push(u),d++;return{aWidth:i,lsBearing:h}}},Dt={cmap:zs,head:Bs,hhea:Os,maxp:{parseTab(o,t,s){const e=L;return e.readUint(o,t),t+=4,{numGlyphs:e.readUshort(o,t)}}},hmtx:Ss,loca:{parseTab(o,t,s,e){const r=L,i=[],h=e.head.indexToLocFormat,n=e.maxp.numGlyphs+1;if(h===0)for(let l=0;l<n;l++)i.push(r.readUshort(o,t+(l<<1))<<1);else if(h===1)for(let l=0;l<n;l++)i.push(r.readUint(o,t+(l<<2)));return i}},glyf:{parseTab(o,t,s,e){const r=[],i=e.maxp.numGlyphs;for(let h=0;h<i;h++)r.push(null);return r},xi(o,t){const s=L,e=o.Fi,r=o.loca;if(r[t]===r[t+1])return null;const i=K.findTable(e,"glyf",o.$i);if(!i)return null;let h=i[0]+r[t];const n={};if(n.noc=s.readShort(e,h),h+=2,n.xMin=s.readShort(e,h),h+=2,n.yMin=s.readShort(e,h),h+=2,n.xMax=s.readShort(e,h),h+=2,n.yMax=s.readShort(e,h),h+=2,n.xMin>=n.xMax||n.yMin>=n.yMax)return null;if(n.noc>0){n.endPts=[];for(let g=0;g<n.noc;g++)n.endPts.push(s.readUshort(e,h)),h+=2;const l=s.readUshort(e,h);if(h+=2,e.length-h<l)return null;h+=l;const c=n.endPts[n.noc-1]+1;n.flags=[];for(let g=0;g<c;g++){const f=e[h];if(h++,n.flags.push(f),8&f){const m=e[h];h++;for(let p=0;p<m;p++)n.flags.push(f),g++}}n.xs=[];for(let g=0;g<c;g++){const f=n.flags[g],m=!!(16&f);2&f?(n.xs.push(m?e[h]:-e[h]),h++):m?n.xs.push(0):(n.xs.push(s.readShort(e,h)),h+=2)}n.ys=[];for(let g=0;g<c;g++){const f=n.flags[g],m=!!(32&f);4&f?(n.ys.push(m?e[h]:-e[h]),h++):m?n.ys.push(0):(n.ys.push(s.readShort(e,h)),h+=2)}let u=0,d=0;for(let g=0;g<c;g++)u+=n.xs[g],d+=n.ys[g],n.xs[g]=u,n.ys[g]=d}else n.parts=[],n.endPts=[],n.flags=[],n.xs=[],n.ys=[];return n}}},K={parse(o){const t=new Uint8Array(o);L.readASCII(t,0,4)==="wOFF"&&(o=Ds(o));const s=new Uint8Array(o),e=Dt,r={},i={Fi:s,Ti:0,$i:0};for(const h in e){const n=h,l=K.findTable(s,n,0);if(l){const[c,u]=l;let d=r[c];d==null&&(d=e[n].parseTab(s,c,u,i),r[c]=d),i[n]=d}}return[i]},findTable(o,t,s){const e=L,r=e.readUshort(o,s+4);let i=s+12;for(let h=0;h<r;h++){const n=e.readASCII(o,i,4);e.readUint(o,i+4);const l=e.readUint(o,i+8),c=e.readUint(o,i+12);if(n===t)return[l,c];i+=16}return null},T:Dt,B:L};class _s{Pi(t){var s;const e=[];return(s=t.cmap)!=null&&s.tables?(t.cmap.tables.forEach(r=>{if(r.format===4){const i=this.Ei(r);e.push(...i)}else if(r.format===12){const i=this.Ri(r);e.push(...i)}}),[...new Set(e)]):[]}Ei(t){const s=[];if(!(t.startCount&&t.endCount&&t.idRangeOffset&&t.idDelta))return s;for(let e=0;e<t.startCount.length;e++){const r=t.startCount[e],i=t.endCount[e];if(r!==65535||i!==65535){for(let h=r;h<=i;h++)if(this.Si(t,h,e)>0)try{const n=String.fromCodePoint(h);s.push(n)}catch{}}}return s}Ri(t){const s=[];if(!t.groups)return s;for(let e=0;e<t.groups.length;e+=3){const r=t.groups[e],i=t.groups[e+1],h=t.groups[e+2];for(let n=r;n<=i;n++)if(h+(n-r)>0)try{const l=String.fromCodePoint(n);s.push(l)}catch{}}return s}Si(t,s,e){if(t.idRangeOffset[e]===0)return s+t.idDelta[e]&65535;{const r=t.idRangeOffset[e]/2+(s-t.startCount[e])-(t.startCount.length-e);if(r>=0&&t.glyphIdArray&&r<t.glyphIdArray.length){const i=t.glyphIdArray[r];if(i!==0)return i+t.idDelta[e]&65535}}return 0}}class Nt{constructor(){a(this,"ki",new Map),a(this,"zi",new Map)}Ii(t,s){const e=`${this.Oi(t)}_${s}`;if(this.ki.has(e))return this.ki.get(e);const r=t.cmap;if(!r||!r.tables)return this.ki.set(e,0),0;let i=0;for(const h of r.tables)if(h.format===4?i=this.Li(s,h):h.format===12&&(i=this.Di(s,h)),i>0)break;return this.ki.set(e,i),i}Bi(t,s){const e=s.codePointAt(0);return e===void 0?0:this.Ii(t,e)}Hi(t,s){const e=t.hmtx;return e&&e.aWidth&&e.aWidth.length!==0?s<e.aWidth.length?e.aWidth[s]:e.aWidth[e.aWidth.length-1]:0}Gi(t,s){const e=s/t.head.unitsPerEm,r=t.hhea.ascender*e,i=t.hhea.descender*e,h=t.hhea.lineGap*e;return{ascender:r,descender:i,lineGap:h,lineHeight:r-i+h,unitsPerEm:t.head.unitsPerEm,scale:e}}Ni(){this.ki.clear(),this.zi.clear()}Oi(t){return`${t.$i}_${t.Fi.length}`}Li(t,s){const e=s.endCount.length;let r=-1;for(let i=0;i<e;i++)if(t<=s.endCount[i]){r=i;break}if(r===-1||t<s.startCount[r])return 0;if(s.idRangeOffset[r]===0)return t+s.idDelta[r]&65535;{const i=s.idRangeOffset[r]/2+(t-s.startCount[r])-(e-r);if(i>=0&&i<s.glyphIdArray.length){const h=s.glyphIdArray[i];return h===0?0:h+s.idDelta[r]&65535}}return 0}Di(t,s){const e=s.groups.length/3;for(let r=0;r<e;r++){const i=s.groups[3*r],h=s.groups[3*r+1],n=s.groups[3*r+2];if(t>=i&&t<=h)return n+(t-i)}return 0}}class Gs{constructor(t){a(this,"Xi"),a(this,"Yi"),a(this,"j"),a(this,"Ki"),this.j=t,this.Ki=new Nt,this.Xi=document.createElement("canvas"),this.Yi=this.Xi.getContext("2d",{willReadFrequently:!0,alpha:!0})}ji(t,s,e,r){const i=t.length,h=Math.ceil(Math.sqrt(i)),n=Math.ceil(i/h),l=s.width*h,c=s.height*n;this.Zi(l,c),this.Wi(t,s,h,e,r);const u=this.j.bi(l,c,1,{filter:"nearest"});return u.st(this.Xi),{framebuffer:u,columns:h,rows:n}}Zi(t,s){this.Xi.width=t,this.Xi.height=s,this.Xi.style.width=t+"px",this.Xi.style.height=s+"px",this.Yi.imageSmoothingEnabled=!1,this.Xi.style.imageRendering="pixelated",this.Yi.clearRect(0,0,t,s),this.Yi.textBaseline="top",this.Yi.textAlign="left",this.Yi.fillStyle="white"}Wi(t,s,e,r,i){const h=r/i.head.unitsPerEm;for(let n=0;n<t.length;n++){const l=n%e,c=Math.floor(n/e),u=t[n].character,d=this.qi(i,u);if(!d)continue;const g=u.codePointAt(0)||0,f=this.Ki.Ii(i,g),m=this.Ki.Hi(i,f)*h,p=l*s.width,v=c*s.height,A=p+.5*s.width,E=v+.5*s.height,y=Math.round(A-.5*s.width),R=Math.round(E-.5*r),b=y+.5*(s.width-m),T=R+i.hhea.ascender*h;this.Vi(d,b,T,h)}}qi(t,s){const e=s.codePointAt(0)||0,r=this.Ki.Ii(t,e);return r===0?null:K.T.glyf.xi(t,r)}Vi(t,s,e,r){if(!t||!t.xs||t.noc===0)return;let{xs:i,ys:h,endPts:n,flags:l}=t;if(!(i&&h&&n&&l))return;this.Yi.beginPath();let c=0;for(let u=0;u<n.length;u++){const d=n[u];if(!(d<c)){if(d>=c){const g=s+i[c]*r,f=e-h[c]*r;this.Yi.moveTo(g,f);let m=c+1;for(;m<=d;)if(1&l[m]){const p=s+i[m]*r,v=e-h[m]*r;this.Yi.lineTo(p,v),m++}else{const p=s+i[m]*r,v=e-h[m]*r;if(m+1>d){const E=s+i[c]*r,y=e-h[c]*r;if(1&l[c])this.Yi.quadraticCurveTo(p,v,E,y);else{const R=(p+E)/2,b=(v+y)/2;this.Yi.quadraticCurveTo(p,v,R,b)}break}const A=m+1;if(1&l[A]){const E=s+i[A]*r,y=e-h[A]*r;this.Yi.quadraticCurveTo(p,v,E,y),m=A+1}else{const E=(p+(s+i[A]*r))/2,y=(v+(e-h[A]*r))/2;this.Yi.quadraticCurveTo(p,v,E,y),m=A}}this.Yi.closePath()}c=d+1}}this.Yi.fill()}}class Xs{constructor(){a(this,"Qi"),this.Qi=new Nt}Ji(t,s,e){let r=0;const i=this.Qi.Gi(e,s),h=i.lineHeight;for(const n of t){const l=this.Qi.Bi(e,n);if(l===0)continue;const c=this.Qi.Hi(e,l)*i.scale;r=Math.max(r,c)}return{width:Math.ceil(r),height:Math.ceil(h)}}Ni(){this.Qi.Ni()}}class Ys{constructor(){a(this,"Ki"),this.Ki=new Nt}createCharacterObjects(t,s){return t.map((e,r)=>{const i=e.codePointAt(0)||0,h=this.tr(r);let n=0;if(s.hmtx&&s.hmtx.aWidth){const l=this.Ki.Ii(s,i);l>0&&s.hmtx.aWidth[l]!==void 0&&(n=s.hmtx.aWidth[l])}return{character:e,unicode:i,color:h,advanceWidth:n}})}tr(t){return[t%256/255,Math.floor(t/256)%256/255,0]}sr(t,s){if(!st.m(typeof t=="string","Character must be a string.",{method:"getCharacterColor",providedValue:t}))return[0,0,0];const e=s.find(r=>r.character===t);return e?e.color:[0,0,0]}er(t,s){return st.m(typeof t=="string"&&t.length>0,"Characters must be a string with at least one character.",{method:"getCharacterColors",providedValue:t})?Array.from(t).map(e=>this.sr(e,s)||[0,0,0]):[[0,0,0]]}}class It{constructor(t,s=16){a(this,"ir"),a(this,"rr",[]),a(this,"nr"),a(this,"hr",16),a(this,"ar",0),a(this,"cr",0),a(this,"lr",{width:0,height:0}),a(this,"ur"),a(this,"dr",new Map),a(this,"pr"),a(this,"gr"),a(this,"vr"),a(this,"mr"),this.hr=s,this.pr=new _s,this.gr=new Gs(t),this.vr=new Xs,this.mr=new Ys}async _r(t){let s;if(t){const e=await fetch(t);if(!e.ok)throw new z(`Failed to load font file: ${e.status} ${e.statusText}`);s=await e.arrayBuffer()}else s=await(await fetch("data:font/woff;base64,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")).arrayBuffer();await this.Ar(s),this.ir=K.parse(s)[0],await this.yr()}wr(t){if(t===void 0)return this.hr;this.hr=t,this.lr=this.vr.Ji(this.rr.map(e=>e.character),this.hr,this.ir);const s=this.gr.ji(this.rr,this.lr,this.hr,this.ir);this.nr=s.framebuffer,this.ar=s.columns,this.cr=s.rows}async br(t){try{const s=await fetch(t);if(!s.ok)throw new z(`Failed to load font file: ${s.status} ${s.statusText}`);const e=await s.arrayBuffer();await this.Ar(e);const r=K.parse(e);if(!r||r.length===0)throw Error("Failed to parse font file");this.ir=r[0],await this.yr()}catch(s){throw new z("Failed to load font: "+(s instanceof Error?s.message:"Unknown error"),s)}}async Ar(t){const s=Date.now();this.ur=new FontFace("CustomFont_"+s,t),await this.ur.load(),document.fonts.add(this.ur)}async yr(){const t=this.pr.Pi(this.ir);this.dr.clear(),this.rr=this.mr.createCharacterObjects(t,this.ir),this.lr=this.vr.Ji(t,this.hr,this.ir);const s=this.gr.ji(this.rr,this.lr,this.hr,this.ir);this.nr=s.framebuffer,this.ar=s.columns,this.cr=s.rows}sr(t){return this.mr.sr(t,this.rr)}er(t){return this.mr.er(t,this.rr)}getGlyphData(t){if(!Number.isFinite(t))return null;const s=this.dr.get(t);if(s!==void 0)return s;const e=this.Cr(t);if(e<0)return this.dr.set(t,null),null;const r=this.ir.glyf;if(!r)return this.dr.set(t,null),null;let i=r[e]??null;return i==null&&(i=K.T.glyf.xi(this.ir,e)??null,r[e]=i),this.dr.set(t,i),i}Cr(t){const s=this.ir.cmap;for(const e of s.tables)if(e.format===4){const r=e;for(let i=0;i<r.startCount.length;i++)if(t>=r.startCount[i]&&t<=r.endCount[i]){if(r.idRangeOffset[i]===0)return t+r.idDelta[i]&65535;{const h=r.idRangeOffset[i]/2+(t-r.startCount[i])-(r.startCount.length-i);if(h>=0&&h<r.glyphIdArray.length){const n=r.glyphIdArray[h];if(n!==0)return n+r.idDelta[i]&65535}}}}else if(e.format===12){const r=e;for(let i=0;i<r.groups.length;i+=3){const h=r.groups[i],n=r.groups[i+1],l=r.groups[i+2];if(t>=h&&t<=n)return l+(t-h)}}return 0}D(){this.nr.D(),document.fonts.delete(this.ur)}get fontFramebuffer(){return this.nr}get characters(){return this.rr}get textureColumns(){return this.ar}get textureRows(){return this.cr}get maxGlyphDimensions(){return this.lr}get fontSize(){return this.hr}get font(){return this.ir}}class Kt{constructor(t,s,e){a(this,"Mr"),a(this,"Fr"),a(this,"H"),a(this,"G"),a(this,"$r"),a(this,"Tr"),a(this,"Pr"),a(this,"Er"),a(this,"Rr"),this.Pr=t,this.Er=s,this.Rr=e,this.Vs()}Vs(){this.Mr=Math.floor(this.Pr.width/this.Er),this.Fr=Math.floor(this.Pr.height/this.Rr),this.H=this.Mr*this.Er,this.G=this.Fr*this.Rr,this.$r=Math.floor((this.Pr.width-this.H)/2),this.Tr=Math.floor((this.Pr.height-this.G)/2)}Sr(t,s){this.Er=t,this.Rr=s,this.Vs()}get cellWidth(){return this.Er}get cellHeight(){return this.Rr}get cols(){return this.Mr}get rows(){return this.Fr}get width(){return this.H}get height(){return this.G}get offsetX(){return this.$r}get offsetY(){return this.Tr}}const js=/^#([0-9a-f]{3,8})$/i,Hs=/^rgba?\(([^)]+)\)$/i;function wt(o){return Number.isNaN(o)?0:Math.max(0,Math.min(255,o))}function ks(o){if(!o)return null;const t=o.trim().toLowerCase();if(!t||t==="transparent")return null;let s=null;return t.startsWith("#")?s=function(e){const r=js.exec(e.trim());if(!r)return null;const i=r[1];return i.length===3?[parseInt(i[0]+i[0],16),parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),255]:i.length===4?[parseInt(i[0]+i[0],16),parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]:i.length===6||i.length===8?[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16),i.length===8?parseInt(i.slice(6,8),16):255]:null}(t):t.startsWith("rgb")&&(s=function(e){const r=Hs.exec(e.trim());if(!r)return null;const i=r[1].split(",").map(u=>u.trim());if(i.length<3)return null;const h=wt(parseFloat(i[0])),n=wt(parseFloat(i[1])),l=wt(parseFloat(i[2])),c=i[3]!==void 0?255*Math.max(0,Math.min(1,parseFloat(i[3]))):255;return[h,n,l,Math.round(c)]}(t)),s?s[3]===0?null:s:null}class Ks{constructor(t={}){a(this,"Pr"),a(this,"kr",null),a(this,"zr",!1),a(this,"Ir"),this.zr=t.overlay??!1,this.zr&&t.canvas?(this.kr=t.canvas,this.Pr=this.Or(),this.Ir=!0,this.Lr()):t.canvas?(this.Pr=t.canvas,this.Ir=!1):(this.Pr=this.Dr(t.width,t.height),this.Ir=!0),this.Pr.style.imageRendering="pixelated"}Dr(t,s){const e=document.createElement("canvas");return e.className="textmodeCanvas",e.style.imageRendering="pixelated",e.width=t||800,e.height=s||600,document.body.appendChild(e),e}Or(){const t=document.createElement("canvas");t.className="textmodeCanvas",t.style.imageRendering="pixelated";const s=this.kr.getBoundingClientRect();let e=Math.round(s.width),r=Math.round(s.height);if(this.kr instanceof HTMLVideoElement){const n=this.kr;(e===0||r===0)&&n.videoWidth>0&&n.videoHeight>0&&(e=n.videoWidth,r=n.videoHeight)}t.width=e,t.height=r,t.style.position="absolute",t.style.pointerEvents="none";const i=window.getComputedStyle(this.kr);let h=parseInt(i.zIndex||"0",10);return isNaN(h)&&(h=0),t.style.zIndex=""+(h+1),t}Lr(){var t;this.Br(),(t=this.kr.parentNode)==null||t.insertBefore(this.Pr,this.kr.nextSibling)}Hr(){const t=[];return this.zr&&this.kr instanceof HTMLElement&&(t.push(this.kr),this.kr.parentElement&&t.push(this.kr.parentElement)),this.Pr.parentElement&&t.push(this.Pr.parentElement),t.push(this.Pr),t.push(document.body),t.push(document.documentElement),t}Gr(){const t=this.Hr();for(const s of t){if(!s)continue;const e=ks(window.getComputedStyle(s).backgroundColor);if(e)return e}return[255,255,255,255]}Br(){if(!this.kr)return;const t=this.kr.getBoundingClientRect();let s=this.kr.offsetParent;if(s&&s!==document.body){const e=s.getBoundingClientRect();this.Pr.style.top=t.top-e.top+"px",this.Pr.style.left=t.left-e.left+"px"}else this.Pr.style.top=t.top+window.scrollY+"px",this.Pr.style.left=t.left+window.scrollX+"px"}Nr(t,s){if(this.zr){const e=this.kr.getBoundingClientRect();this.Pr.width=Math.round(e.width),this.Pr.height=Math.round(e.height),this.Br()}else this.Pr.width=t??this.Pr.width,this.Pr.height=s??this.Pr.height}Xr(){const t=this.Pr.getContext("webgl2",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!0,stencil:!1,powerPreference:"high-performance"});if(!t)throw new z("`textmode.js` requires WebGL2 support.");return t}D(){const t=this.Pr.getContext("webgl")||this.Pr.getContext("webgl2");if(t){const s=t.getExtension("WEBGL_lose_context");s==null||s.loseContext()}this.Ir&&this.Pr.parentNode&&this.Pr.parentNode.removeChild(this.Pr)}get canvas(){return this.Pr}get targetCanvas(){return this.kr}get width(){return this.Pr.width}get height(){return this.Pr.height}}const Ws=/^#|0x/gi;function tt(o){return Number.isNaN(o)||!Number.isFinite(o)||o<=0?0:o>=255?255:Math.round(o)}function ht(o){return tt(parseInt(o,16))}class U{constructor(t,s,e,r,i){a(this,"Yr"),a(this,"Kr"),a(this,"Ht"),a(this,"r"),a(this,"g"),a(this,"b"),a(this,"a"),this.r=tt(t),this.g=tt(s),this.b=tt(e),this.a=tt(r),this.Yr=[this.r,this.g,this.b,this.a],this.Kr=[this.r/255,this.g/255,this.b/255,this.a/255],this.Ht=i?[...i]:void 0}static jr(t,s,e,r=255){return new U(t,s,e,r)}static Zr(t,s=255){return new U(t,t,t,s)}static Wr(t){const[s,e,r,i]=function(h){const n=h.replace(Ws,""),l=(c=n).length===3||c.length===4?c.split("").map(u=>u+u).join(""):c;var c;if(l.length!==6&&l.length!==8)throw Error("Invalid hex color: "+h);return[ht(l.slice(0,2)),ht(l.slice(2,4)),ht(l.slice(4,6)),l.length===8?ht(l.slice(6,8)):255]}(t);return new U(s,e,r,i)}static qr(t){const[s,e,r]=t;return new U(255*s,255*e,255*r,255,t)}get rgb(){return[this.r,this.g,this.b]}get rgba(){return[...this.Yr]}get normalized(){return[...this.Kr]}get character(){return this.Ht?[...this.Ht]:void 0}static Vr(t){return t instanceof U}}const Wt=class at{constructor(t,s,e,r,i,h,n){a(this,"A"),a(this,"j"),a(this,"Qr"),a(this,"Jr"),a(this,"tn"),a(this,"H"),a(this,"G"),a(this,"Z",null),a(this,"$t",0),a(this,"Dt",0),a(this,"Bt",0),a(this,"Tt",0),a(this,"sn","sampled"),a(this,"en","fixed"),a(this,"Gt",[1,1,1,1]),a(this,"Nt",[0,0,0,1]),a(this,"rn",[0,0,0,1]),a(this,"nn",[[.1,0,0]]),a(this,"hn"),this.A=t,this.j=s,this.Qr=e,this.Jr=r,this.tn=i,this.H=h,this.G=n}D(){this.A.deleteTexture(this.Qr)}invert(t=!0){return this.$t=t?1:0,this.Z=null,this}flipX(t=!0){return this.Dt=t?1:0,this.Z=null,this}flipY(t=!0){return this.Bt=t?1:0,this.Z=null,this}charRotation(t){return this.Tt=St(t),this.Z=null,this}charColorMode(t){return this.sn=t,this.Z=null,this}cellColorMode(t){return this.en=t,this.Z=null,this}charColor(t,s,e,r){return this.cn(this.Gt,t,s,e,r),this.Z=null,this}cellColor(t,s,e,r){return this.cn(this.Nt,t,s,e,r),this.Z=null,this}background(t,s,e,r){return this.cn(this.rn,t,s,e,r),this.Z=null,this}characters(t){if(!this.hn)throw Error("Glyph color resolver not initialized");const s=this.hn(t).filter(e=>Array.isArray(e)).slice(0,64);return this.nn=s,this.Z=null,this}get texture(){return this.Qr}get width(){return this.H}get height(){return this.G}get originalWidth(){return this.Jr}get originalHeight(){return this.tn}ct(){return this.Z||this.lt(),this.Z}ln(){}lt(){this.ln();const t=this.un(),s=this.fn();this.Z=this.j.ft.Be(t,s)}cn(t,s,e,r,i){if(U.Vr(s))k(t,s.r,s.g,s.b,s.a);else{if(typeof s=="string"){const h=U.Wr(s);return void k(t,h.r,h.g,h.b,h.a)}k(t,s,e,r,i)}}un(){return at.an||(at.an=new et(this.A,lt,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D Ug;uniform bool Uh;uniform bool Ui;uniform bool Uj;uniform float Uk;uniform bool Ul;uniform vec4 Um;uniform bool Un;uniform vec4 Uo;uniform vec4 Up;uniform int Uq;uniform vec3 Ur[64];layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;float A(vec3 B){return dot(B,vec3(0.299f,0.587f,0.114f));}void main(){vec2 C=vec2(v_uv.x,1.0f-v_uv.y);vec4 D=texture(Ug,C);float E=A(D.rgb);vec2 F=vec2(0.);if(Uq>0){float G=float(Uq);float H=clamp(E*(G-1.0f),0.0f,G-1.0f);int I=int(floor(H+0.5f));vec3 J=Ur[I];F=J.xy;}else{F=vec2(E,0.0f);}vec4 K=Ul?Um:D;vec4 L=Un?Uo:D;if(D.a<0.01f){K=Up;L=Up;}else{}o_primaryColor=vec4(K.rgb,K.a);o_secondaryColor=vec4(L.rgb,L.a);int M=int(Uh?1:0);int N=int(Ui?1:0);int O=int(Uj?1:0);float P=float(M|(N<<1)|(O<<2))/255.;o_character=vec4(F,P,clamp(Uk,0.0f,1.0f));}`)),at.an}fn(){return{Ug:this.dn(),Uh:!!this.$t,Ui:!!this.Dt,Uj:!!this.Bt,Uk:this.Tt,Ul:this.sn==="fixed",Um:this.Gt,Un:this.en==="fixed",Uo:this.Nt,Up:this.rn,Uq:this.nn.length,Ur:this.nn}}};a(Wt,"an",null);let Zt=Wt;class W extends Zt{constructor(t,s,e,r,i,h,n){const l=Math.min(h/r,n/i);super(t,s,e,r,i,Math.max(1,Math.floor(r*l)),Math.max(1,Math.floor(i*l)))}static pn(t,s,e,r,i){const h=t.context,n=h.createTexture();h.bindTexture(h.TEXTURE_2D,n),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,1),ct(h,h.NEAREST,h.NEAREST,h.CLAMP_TO_EDGE,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,s),h.bindTexture(h.TEXTURE_2D,null);const l=s.naturalWidth??s.width??s.videoWidth??0,c=s.naturalHeight??s.height??s.videoHeight??0,u=new W(h,t,n,l,c,e,r);return u.hn=i,u}dn(){return this.Qr}}class Vt{constructor(t=60){a(this,"gn"),a(this,"vn",null),a(this,"mn",0),a(this,"_n",!0),a(this,"An",0),a(this,"yn",0),a(this,"wn",[]),a(this,"bn",10),a(this,"Cn",0),this.gn=1e3/t}Mn(t){if(!this._n)return;this.mn=performance.now();const s=e=>{if(!this._n)return void(this.vn=null);const r=e-this.mn;r>=this.gn&&(t(),this.mn=e-r%this.gn),this._n&&(this.vn=requestAnimationFrame(s))};this.vn=requestAnimationFrame(s)}xn(){this.vn&&(cancelAnimationFrame(this.vn),this.vn=null)}Fn(){this._n&&(this._n=!1,this.xn())}$n(t){this._n||(this._n=!0,this.Mn(t))}Tn(t,s){if(t===void 0)return this.An;this.gn=1e3/t,this._n&&s&&(this.xn(),this.Mn(s))}Pn(){const t=performance.now();if(this.yn>0){const s=t-this.yn;this.wn.push(s),this.wn.length>this.bn&&this.wn.shift();const e=this.wn.reduce((r,i)=>r+i,0)/this.wn.length;this.An=1e3/e}this.yn=t}get En(){return this._n}get Rn(){return this.An}get Sn(){return this.Cn}set Sn(t){this.Cn=t}kn(){this.Cn++}}class qt{constructor(t){a(this,"Pr"),a(this,"zn"),a(this,"In",{x:-1,y:-1}),a(this,"On",{x:-1,y:-1}),a(this,"Ln",null),a(this,"Dn",0),a(this,"Bn"),a(this,"Hn"),a(this,"Gn"),a(this,"Nn"),a(this,"Xn"),a(this,"Yn"),a(this,"Kn",!1),a(this,"jn"),a(this,"Zn"),a(this,"Wn"),a(this,"qn"),a(this,"Vn"),this.Pr=t}Qn(t){const s=performance.now()+Math.max(0,t);s>this.Dn&&(this.Dn=s)}Jn(){return performance.now()<this.Dn}so(t){const s=this.Pr.canvas;s.style.cursor=t==null||t===""?"":t}_r(t){this.zn=t,this.eo()}io(){if(this.Kn)return;const t=this.Pr.canvas;this.Bn=s=>{this.ro(s),this.no(s)},this.Hn=()=>{this.On={...this.In},this.In.x=-1,this.In.y=-1,this.Ln=null},this.Gn=s=>{this.ro(s),this.oo(s)},this.Nn=s=>{this.ro(s),this.ho(s)},this.Xn=s=>{this.ro(s),this.ao(s)},this.Yn=s=>{this.ro(s),this.co(s)},t.addEventListener("mousemove",this.Bn,{passive:!0}),t.addEventListener("mouseleave",this.Hn,{passive:!0}),t.addEventListener("mousedown",this.Gn,{passive:!0}),t.addEventListener("mouseup",this.Nn,{passive:!0}),t.addEventListener("click",this.Xn,{passive:!0}),t.addEventListener("wheel",this.Yn,{passive:!1}),this.Kn=!0}lo(){if(!this.Kn)return;const t=this.Pr.canvas;t.removeEventListener("mousemove",this.Bn),t.removeEventListener("mouseleave",this.Hn),t.removeEventListener("mousedown",this.Gn),t.removeEventListener("mouseup",this.Nn),t.removeEventListener("click",this.Xn),t.removeEventListener("wheel",this.Yn),this.Kn=!1}eo(){if(this.Kn)try{if(this.Ln){const t=new MouseEvent("mousemove",{clientX:this.Ln.x,clientY:this.Ln.y,bubbles:!1,cancelable:!1});this.ro(t)}else this.In.x!==-1&&this.In.y!==-1&&(this.In.x>=this.zn.cols||this.In.y>=this.zn.rows)&&(this.In.x=-1,this.In.y=-1)}catch{this.In.x=-1,this.In.y=-1}}uo(t){this.jn=t}fo(t){this.Zn=t}do(t){this.Wn=t}po(t){this.qn=t}vo(t){this.Vn=t}mo(){return{x:this.In.x,y:this.In.y}}no(t){if(this.qn&&!this.Jn()){const s={position:{...this.In},previousPosition:{...this.On},originalEvent:t};this.qn(s)}}oo(t){if(this.Zn&&!this.Jn()){const s={position:{...this.In},previousPosition:{...this.On},button:t.button,originalEvent:t};this.Zn(s)}}ho(t){if(this.Wn&&!this.Jn()){const s={position:{...this.In},previousPosition:{...this.On},button:t.button,originalEvent:t};this.Wn(s)}}ao(t){if(this.jn&&!this.Jn()){const s={position:{...this.In},previousPosition:{...this.On},button:t.button,originalEvent:t};this.jn(s)}}co(t){if(this.Vn&&!this.Jn()){const s={position:{...this.In},previousPosition:{...this.On},delta:{x:t.deltaX,y:t.deltaY},originalEvent:t};this.Vn(s)}}ro(t){const s=this.Pr.canvas;this.On={...this.In},this.Ln={x:t.clientX,y:t.clientY};const e=s.getBoundingClientRect(),r=t.clientX-e.left,i=t.clientY-e.top,h=s.width/e.width,n=i*(s.height/e.height),l=r*h-this.zn.offsetX,c=n-this.zn.offsetY,u=Math.floor(l/this.zn.cellWidth),d=Math.floor(c/this.zn.cellHeight);u>=0&&u<this.zn.cols&&d>=0&&d<this.zn.rows?(this.In.x=u,this.In.y=d):(this.In.x=-1,this.In.y=-1)}}const Zs=Object.freeze(Object.defineProperty({__proto__:null,MouseManager:qt},Symbol.toStringTag,{value:"Module"}));class Jt{constructor(){a(this,"_o",new Map),a(this,"Ao",null),a(this,"yo",null),a(this,"wo"),a(this,"bo"),a(this,"Kn",!1),a(this,"Co"),a(this,"Mo"),a(this,"xo",{ArrowUp:"UP_ARROW",ArrowDown:"DOWN_ARROW",ArrowLeft:"LEFT_ARROW",ArrowRight:"RIGHT_ARROW",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",Enter:"ENTER",Return:"RETURN",Tab:"TAB",Escape:"ESCAPE",Backspace:"BACKSPACE",Delete:"DELETE",Insert:"INSERT",Home:"HOME",End:"END",PageUp:"PAGE_UP",PageDown:"PAGE_DOWN",Shift:"SHIFT",Control:"CONTROL",Alt:"ALT",Meta:"META"," ":"SPACE"})}io(){this.Kn||(this.wo=t=>{this.Fo(t)},this.bo=t=>{this.$o(t)},window.addEventListener("keydown",this.wo,{passive:!1}),window.addEventListener("keyup",this.bo,{passive:!1}),this.Kn=!0)}lo(){this.Kn&&(window.removeEventListener("keydown",this.wo),window.removeEventListener("keyup",this.bo),this.Kn=!1,this._o.clear(),this.Ao=null,this.yo=null)}fo(t){this.Co=t}do(t){this.Mo=t}To(t){const s=this.Po(t),e=this._o.get(t)||this._o.get(s);return(e==null?void 0:e.isPressed)||!1}Eo(){return this.Ao}Ro(){return this.yo}So(){const t=[];for(const[s,e]of this._o)e.isPressed&&t.push(s);return t}ko(){return{ctrl:this.To("Control"),shift:this.To("Shift"),alt:this.To("Alt"),meta:this.To("Meta")}}zo(){this._o.clear(),this.Ao=null,this.yo=null}Fo(t){const s=t.key,e=Date.now();this._o.has(s)||this._o.set(s,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const r=this._o.get(s);if(!r.isPressed&&(r.isPressed=!0,r.lastPressTime=e,this.Ao=s,this.Co)){const i={key:s,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!0,originalEvent:t};this.Co(i)}}$o(t){const s=t.key,e=Date.now();this._o.has(s)||this._o.set(s,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const r=this._o.get(s);if(r.isPressed=!1,r.lastReleaseTime=e,this.yo=s,this.Mo){const i={key:s,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!1,originalEvent:t};this.Mo(i)}}Po(t){return this.xo[t]||t.toLowerCase()}}const Vs=Object.freeze(Object.defineProperty({__proto__:null,KeyboardManager:Jt},Symbol.toStringTag,{value:"Module"}));class Qt{constructor(t,s){a(this,"Pr"),a(this,"Io"),a(this,"zn"),a(this,"Oo",new Map),a(this,"Lo",new Map),a(this,"Do",new Map),a(this,"Bo",null),a(this,"Ho"),a(this,"Go"),a(this,"No"),a(this,"Xo"),a(this,"Yo"),a(this,"Ko"),a(this,"Kn",!1),a(this,"jo"),a(this,"Zo"),a(this,"Wo"),a(this,"qo"),a(this,"Vo"),a(this,"Qo"),a(this,"Jo"),a(this,"th"),a(this,"sh"),a(this,"eh"),a(this,"ih",320),a(this,"rh",350),a(this,"nh",10),a(this,"oh",550),a(this,"hh",14),a(this,"ah",48),a(this,"uh",650),a(this,"fh",.02),a(this,"dh",2),a(this,"ph",600),a(this,"gh",0),a(this,"mh",null),this.Pr=t,this.Io=s;const e=this.Pr.canvas;this.Ho=e.style.touchAction,this.Go=e.style.userSelect,e.style.touchAction||(e.style.touchAction="none"),e.style.userSelect||(e.style.userSelect="none")}_r(t){this.zn=t,this.eo()}io(){if(this.Kn)return;const t=this.Pr.canvas;this.No=s=>{this._h(s)},this.Xo=s=>{this.Ah(s)},this.Yo=s=>{this.yh(s)},this.Ko=s=>{this.wh(s)},t.addEventListener("touchstart",this.No,{passive:!1}),t.addEventListener("touchmove",this.Xo,{passive:!1}),t.addEventListener("touchend",this.Yo,{passive:!1}),t.addEventListener("touchcancel",this.Ko,{passive:!1}),this.Kn=!0}lo(){if(!this.Kn)return;const t=this.Pr.canvas;t.removeEventListener("touchstart",this.No),t.removeEventListener("touchmove",this.Xo),t.removeEventListener("touchend",this.Yo),t.removeEventListener("touchcancel",this.Ko),this.Kn=!1,this.Bo=null,this.Oo.clear(),this.Lo.clear(),this.Do.forEach(s=>{s.longPressTimer!==null&&window.clearTimeout(s.longPressTimer)}),this.Do.clear(),this.mh=null,this.gh=0,t.style.touchAction=this.Ho,t.style.userSelect=this.Go}eo(){if(!this.zn||this.Oo.size===0)return;const t=new Map;for(const s of this.Oo.values()){const e=this.bh(s.clientX,s.clientY,s.id,s);t.set(s.id,e)}this.Oo=t}Ch(){return Array.from(this.Oo.values()).map(t=>({...t}))}Mh(t){this.jo=t}po(t){this.Zo=t}xh(t){this.Wo=t}Fh(t){this.qo=t}$h(t){this.Vo=t}Th(t){this.Qo=t}Ph(t){this.Jo=t}Eh(t){this.th=t}Rh(t){this.sh=t}Sh(t){this.eh=t}_h(t){var s;if(!this.zn)return;t.preventDefault(),(s=this.Io)==null||s.Qn(this.ph);const e=performance.now(),r=this.kh(t.changedTouches);for(const i of r){const h=this.Oo.get(i.id);h&&this.Lo.set(i.id,this.zh(h)),this.Oo.set(i.id,i);const n={id:i.id,startPosition:i,lastPosition:i,startTime:e,lastTime:e,longPressTimer:null,longPressFired:!1};this.Jo&&(n.longPressTimer=window.setTimeout(()=>{const l=this.Oo.get(i.id);l&&(n.longPressFired=!0,this.Jo({touch:this.zh(l),duration:performance.now()-n.startTime,originalEvent:t}))},this.oh)),this.Do.set(i.id,n),this.jo&&this.jo(this.Ih(i,t,void 0,e))}this.Oo.size===2&&this.Oh()}Ah(t){var s;if(!this.zn)return;t.preventDefault(),(s=this.Io)==null||s.Qn(this.ph);const e=performance.now(),r=this.kh(t.changedTouches);for(const i of r){const h=this.Oo.get(i.id),n=h?this.zh(h):void 0;n&&this.Lo.set(i.id,n),this.Oo.set(i.id,i);const l=this.Do.get(i.id);l&&(l.lastPosition=i,l.lastTime=e,n)&&V(n.clientX,n.clientY,i.clientX,i.clientY)>this.hh&&l.longPressTimer!==null&&(window.clearTimeout(l.longPressTimer),l.longPressTimer=null),this.Zo&&this.Zo(this.Ih(i,t,n,e))}this.Oo.size===2?this.Lh(t):this.Bo=null}yh(t){if(!this.zn)return;t.preventDefault();const s=performance.now(),e=this.kh(t.changedTouches);for(const r of e){const i=this.Oo.get(r.id),h=i?this.zh(i):void 0,n=this.Do.get(r.id);n&&n.longPressTimer!==null&&(window.clearTimeout(n.longPressTimer),n.longPressTimer=null),this.Wo&&this.Wo(this.Ih(r,t,h,s)),n&&this.Dh(n,t),this.Do.delete(r.id),this.Lo.delete(r.id),this.Oo.delete(r.id)}this.Oo.size<2&&(this.Bo=null)}wh(t){if(!this.zn)return;t.preventDefault();const s=performance.now(),e=this.kh(t.changedTouches);for(const r of e){const i=this.Oo.get(r.id),h=i?this.zh(i):void 0,n=this.Do.get(r.id);n&&n.longPressTimer!==null&&(window.clearTimeout(n.longPressTimer),n.longPressTimer=null),this.qo&&this.qo(this.Ih(r,t,h,s)),this.Do.delete(r.id),this.Lo.delete(r.id),this.Oo.delete(r.id)}this.Oo.size<2&&(this.Bo=null)}kh(t){const s=[];for(let e=0;e<t.length;e+=1){const r=t.item(e);r&&s.push(this.Bh(r))}return s}Bh(t){return this.bh(t.clientX,t.clientY,t.identifier,{id:t.identifier,x:-1,y:-1,clientX:t.clientX,clientY:t.clientY,pressure:t.force,radiusX:t.radiusX,radiusY:t.radiusY,rotationAngle:t.rotationAngle})}bh(t,s,e,r){const i=this.Pr.canvas,h=i.getBoundingClientRect(),n=t-h.left,l=s-h.top,c=i.width/h.width,u=l*(i.height/h.height),d=n*c-this.zn.offsetX,g=u-this.zn.offsetY,f=Math.floor(d/this.zn.cellWidth),m=Math.floor(g/this.zn.cellHeight),p=f>=0&&f<this.zn.cols&&m>=0&&m<this.zn.rows;return{id:e,x:p?f:-1,y:p?m:-1,clientX:t,clientY:s,pressure:r.pressure,radiusX:r.radiusX,radiusY:r.radiusY,rotationAngle:r.rotationAngle}}Ih(t,s,e,r){const i=this.Do.get(t.id),h=Array.from(this.Lo.values()).map(c=>this.zh(c)),n=Array.from(this.Oo.values()).map(c=>this.zh(c)),l=this.kh(s.changedTouches);return{touch:this.zh(t),previousTouch:e?this.zh(e):void 0,touches:n,previousTouches:h,changedTouches:l,deltaTime:i?r-i.lastTime:0,originalEvent:s}}Oh(){if(this.Oo.size!==2)return void(this.Bo=null);const t=Array.from(this.Oo.values()),[s,e]=t,r=V(s.x,s.y,e.x,e.y),i=Lt(s.clientX,s.clientY,e.clientX,e.clientY);this.Bo={ids:[s.id,e.id],initialDistance:Math.max(r,1e-4),initialAngle:i,lastScale:1,lastRotation:0}}Lh(t){if(this.Bo||this.Oh(),!this.Bo)return;const[s,e]=this.Bo.ids,r=this.Oo.get(s),i=this.Oo.get(e);if(!r||!i)return;const h=V(r.x,r.y,i.x,i.y)/this.Bo.initialDistance,n=h-this.Bo.lastScale;this.sh&&Math.abs(n)>this.fh&&(this.sh({touches:[this.zh(r),this.zh(i)],scale:h,deltaScale:n,center:this.Hh(r,i),originalEvent:t}),this.Bo.lastScale=h);let l=Lt(r.clientX,r.clientY,i.clientX,i.clientY)-this.Bo.initialAngle;l=(l+180)%360-180;const c=l-this.Bo.lastRotation;this.eh&&Math.abs(c)>this.dh&&(this.eh({touches:[this.zh(r),this.zh(i)],rotation:l,deltaRotation:c,center:this.Hh(r,i),originalEvent:t}),this.Bo.lastRotation=l)}Hh(t,s){const e=(t.clientX+s.clientX)/2,r=(t.clientY+s.clientY)/2,i=this.bh(e,r,-1,{id:-1,x:-1,y:-1,clientX:e,clientY:r});return{x:i.x,y:i.y}}Dh(t,s){const e=performance.now(),r=e-t.startTime,i=V(t.startPosition.clientX,t.startPosition.clientY,t.lastPosition.clientX,t.lastPosition.clientY);if(!t.longPressFired&&r<=this.ih&&i<=this.nh)this.Gh(t.lastPosition,e)&&this.Qo?this.Qo({touch:this.zh(t.lastPosition),taps:2,originalEvent:s}):this.Vo&&this.Vo({touch:this.zh(t.lastPosition),taps:1,originalEvent:s});else if(!t.longPressFired&&r<=this.uh&&i>=this.ah){const h={x:t.lastPosition.clientX-t.startPosition.clientX,y:t.lastPosition.clientY-t.startPosition.clientY},n=Math.max(Math.hypot(h.x,h.y),1e-4),l={x:h.x/n,y:h.y/n},c={x:h.x/r,y:h.y/r};this.th&&this.th({touch:this.zh(t.lastPosition),direction:l,distance:n,velocity:c,originalEvent:s})}this.gh=e,this.mh=this.zh(t.lastPosition)}Gh(t,s){return!this.mh||s-this.gh>this.rh?!1:V(t.clientX,t.clientY,this.mh.clientX,this.mh.clientY)<=this.nh}zh(t){return{...t}}}const qs=Object.freeze(Object.defineProperty({__proto__:null,TouchManager:Qt},Symbol.toStringTag,{value:"Module"}));class ft extends Zt{constructor(t,s,e,r,i,h,n,l){const c=i/h;let u,d;c>1?(u=n,d=Math.round(n/c)):(d=l,u=Math.round(l*c)),super(t,s,e,i,h,u,d),a(this,"Nh"),a(this,"Xh",!1),a(this,"Yh",[]),a(this,"An",null),a(this,"Kh",0),a(this,"jh",0),a(this,"Zh",-1),this.Nh=r}D(){super.D();for(const t of this.Yh)this.A.deleteTexture(t);this.Yh=[],this.Nh.pause(),this.Nh.src="",this.Nh.load()}Wh(){if(!this.Xh&&this.Nh.readyState>=this.Nh.HAVE_CURRENT_DATA){const t=this.A;t.bindTexture(t.TEXTURE_2D,this.Qr),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.Nh),t.bindTexture(t.TEXTURE_2D,null)}}dn(){if(this.Xh&&this.Yh.length>0){const t=this.jh%this.Yh.length;return this.Yh[t]}return this.Qr}ct(){return this.Z=null,super.ct()}ln(){this.Wh()}async qh(t,s){var e;try{if(t<=0)throw Error("Video preload requires a frameRate greater than 0.");const r=this.Nh.duration;if(!isFinite(r)||r<=0)throw Error("Video duration is invalid, cannot preload frames.");const i=Math.max(1,Math.ceil(r*t));if(this.Vh(t,i),await this.Qh(t,s))return void this.Jh("captureStream",s);await this.ta(t,s),this.Jh("seeking",s)}catch(r){const i=r instanceof Error?r:Error(r+"");throw(e=s==null?void 0:s.onError)==null||e.call(s,i),i}}Vh(t,s){this.An=t,this.Kh=s,this.Yh=[],this.Xh=!1,this.jh=0,this.Zh=-1}Jh(t,s){var e;if(this.Yh.length===0)throw Error(`Video preload via ${t} completed but produced 0 frames.`);this.Kh=this.Yh.length,this.Xh=!0,this.jh=0,this.Zh=-1,this.Nh.pause(),this.Nh.currentTime=0,s!=null&&s.onProgress&&s.onProgress({percent:100,loadedFrames:this.Kh,totalFrames:this.Kh,strategy:t}),(e=s==null?void 0:s.onComplete)==null||e.call(s,{totalFrames:this.Kh,strategy:t})}sa(t){const s=this.A,e=s.createTexture();return s.bindTexture(s.TEXTURE_2D,e),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),ct(s,s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),s.bindTexture(s.TEXTURE_2D,null),e}ea(t,s){if(!(s!=null&&s.onProgress)||this.Kh===0)return;const e=Math.min(99,Math.floor(this.Yh.length/this.Kh*100)),r=10*Math.floor(e/10);r>this.Zh&&(this.Zh=r,s.onProgress({percent:e,loadedFrames:this.Yh.length,totalFrames:this.Kh,strategy:t}))}async Qh(t,s){const e=globalThis,r=e==null?void 0:e.MediaStreamTrackProcessor,i=this.Nh.captureStream;if(typeof r!="function"||typeof i!="function")return!1;let h,n=null;try{const l=i.call(this.Nh);if(h=l.getVideoTracks()[0],!h)return l.getTracks().forEach(d=>d.stop()),!1;if(n=new r({track:h}).readable.getReader(),this.Nh.currentTime=0,this.Nh.muted=!0,await this.Nh.play().catch(()=>{}),this.Nh.paused)return!1;const c=1e6/t;let u=0;for(;this.Yh.length<this.Kh;){const d=await n.read();if(d.done)break;const g=d.value;if(g)try{const f=typeof g.timestamp=="number"?g.timestamp:u;(this.Yh.length===0||f>=u)&&(this.Yh.push(this.sa(g)),u=f+c,this.ea("captureStream",s))}finally{g.close()}}return n.releaseLock(),h.stop(),n=null,h=void 0,this.Nh.pause(),this.Nh.currentTime=0,this.Yh.length!==0}catch{return this.Yh=[],this.Zh=-1,!1}finally{if(n)try{await n.cancel()}catch{}h&&h.stop(),this.Nh.pause(),this.Nh.currentTime=0}}async ta(t,s){const e=1/t,r=this.Kh,i=this.Nh;i.pause();for(let h=0;h<r;h++){const n=Math.min(i.duration,h*e);await this.ia(n),this.Yh.push(this.sa(i)),this.ea("seeking",s)}i.currentTime=0}ia(t){return new Promise((s,e)=>{const r=this.Nh,i=()=>{r.removeEventListener("seeked",h),r.removeEventListener("error",n)},h=()=>{i(),s()},n=()=>{i(),e(Error("Video seek failed while preloading frames."))};r.addEventListener("seeked",h,{once:!0}),r.addEventListener("error",n,{once:!0});const l=isFinite(r.duration)?r.duration:t,c=Math.min(Math.max(t,0),l);if(Math.abs(r.currentTime-c)<1e-4)return i(),void s();r.currentTime=c})}frame(t){return this.Xh&&t!==void 0&&this.Kh>0&&(this.jh=(t%this.Kh+this.Kh)%this.Kh,this.Z=null),this}static async pn(t,s,e,r,i,h){const n=t.context,l=h==null?void 0:h.frameRate;let c;typeof s=="string"?(c=document.createElement("video"),c.crossOrigin="anonymous",c.loop=!0,c.muted=!0,c.playsInline=!0,await new Promise((m,p)=>{c.addEventListener("loadedmetadata",()=>m(),{once:!0}),c.addEventListener("error",v=>{var A;const E=v.target;p(Error("Failed to load video: "+(((A=E.error)==null?void 0:A.message)||"Unknown error")))},{once:!0}),c.src=s})):(c=s,c.readyState<c.HAVE_METADATA&&await new Promise((m,p)=>{c.addEventListener("loadedmetadata",()=>m(),{once:!0}),c.addEventListener("error",v=>{var A;return p(Error("Video error: "+((A=v.target.error)==null?void 0:A.message)))},{once:!0})}));const u=n.createTexture();n.bindTexture(n.TEXTURE_2D,u),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1),ct(n,n.LINEAR,n.LINEAR,n.CLAMP_TO_EDGE,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,c),n.bindTexture(n.TEXTURE_2D,null);const d=c.videoWidth,g=c.videoHeight,f=new ft(n,t,u,c,d,g,e,r);return f.hn=i,l&&l>0&&await f.qh(l,h),f}async play(){await this.Nh.play()}pause(){this.Nh.pause()}stop(){this.Nh.pause(),this.Nh.currentTime=0}speed(t){return this.Nh.playbackRate=t,this}loop(t=!0){return this.Nh.loop=t,this}time(t){return this.Nh.currentTime=t,this}volume(t){return this.Nh.volume=Math.max(0,Math.min(1,t)),this}get texture(){return this.Qr}get width(){return this.H}get height(){return this.G}get originalWidth(){return this.Jr}get originalHeight(){return this.tn}get videoElement(){return this.Nh}get currentTime(){return this.Nh.currentTime}get duration(){return this.Nh.duration}get isPlaying(){return!this.Nh.paused&&!this.Nh.ended}get isPreloaded(){return this.Xh}get totalFrames(){return this.Kh}get preloadFrameRate(){return this.An}get currentFrameIndex(){return this.jh}}const Js=o=>class extends o{ra(t,s,e,r){if(U.Vr(t))return t;if(typeof t=="number"||typeof t=="string")return this.color(t,s,e,r);throw Error("Unsupported color input passed to color-capable method.")}rotate(t=0,s=0,e=0){this.j.state.Wt(t),this.j.state.qt(s),this.j.state.Vt(e)}rotateX(t){this.j.state.Wt(t)}rotateY(t){this.j.state.qt(t)}rotateZ(t){this.j.state.Vt(t)}translate(t=0,s=0,e=0){this.j.state.Qt(t,s,e)}translateX(t){this.j.state.Qt(t,0,0)}translateY(t){this.j.state.Qt(0,t,0)}translateZ(t){this.j.state.Qt(0,0,t)}push(){this.j.state.rt()}pop(){this.j.state.nt()}color(t,s,e,r){if(U.Vr(t))return t;if(typeof t=="string"){const i=Array.from(t);if(i.length===1){const h=i[0],n=this.ir.sr(h);return U.qr(n)}return U.Wr(t)}if(typeof t=="number")return typeof s=="number"&&typeof e=="number"?U.jr(t,s,e,r??255):typeof s=="number"&&e===void 0?U.Zr(t,s):U.Zr(t,r??255);throw Error("Unsupported color input passed to color().")}rect(t=1,s=1){this.j.gi(t,s)}point(){this.j.gi(1,1)}line(t,s,e,r){this.j.mi(t,s,e,r)}lineWeight(t){this.j.state.jt(t)}background(t,s,e,r=255){const i=this.ra(t,s,e,r);this.j.Ci(i.r,i.g,i.b,i.a)}char(t){if(U.Vr(t)){const e=t.character;return void(e&&this.j.state.es(e))}const s=Array.from(t);if(s.length===0)throw Error("char() requires at least one character.");this.j.state.es(this.ir.sr(s[0]))}charColor(t,s,e,r){const i=this.ra(t,s,e,r);this.j.state.rs(i.r,i.g,i.b,i.a)}cellColor(t,s,e,r){const i=this.ra(t,s,e,r);this.j.state.ns(i.r,i.g,i.b,i.a)}flipX(t){this.j.state.hs(t)}flipY(t){this.j.state.cs(t)}charRotation(t){this.j.state.us(t)}invert(t){this.j.state.ls(t)}clear(){this.j.Ci(0,0,0,0)}ellipse(t,s){this.j._i(t/2,s/2)}triangle(t,s,e,r,i,h){this.j.Ai(t,s,e,r,i,h)}bezierCurve(t,s,e,r,i,h,n,l){this.j.yi(t,s,e,r,i,h,n,l)}arc(t,s,e,r){this.j.wi(t/2,s/2,e,r)}shader(t){this.j.li(t)}setUniform(t,s){this.j.O(t,s)}setUniforms(t){this.j.ui(t)}async createFilterShader(t){if(typeof t=="string"&&(t.includes("/")||t.startsWith("./")||t.startsWith("../")||t.endsWith(".frag")||t.endsWith(".glsl"))){const s=await fetch(t);if(!s.ok)throw Error(`Failed to load shader from ${t}: ${s.statusText}`);const e=await s.text();return this.j.fi(e)}return this.j.fi(t)}createFramebuffer(t){return this.j.bi(t.width??this.grid.cols,t.height??this.grid.rows,3)}image(t,s,e){this.j.di(t,s,e)}ortho(){this.j.state.ds(!0)}async loadImage(t){if(typeof t!="string")return W.pn(this.j,t,this.zn.cols,this.zn.rows,r=>this.ir.er(r));const s=t,e=await new Promise((r,i)=>{const h=new Image;h.crossOrigin="anonymous",h.onload=()=>r(h),h.onerror=n=>i(n),h.src=s});return W.pn(this.j,e,this.zn.cols,this.zn.rows,r=>this.ir.er(r))}async loadVideo(t,s){return ft.pn(this.j,t,this.zn.cols,this.zn.rows,e=>this.ir.er(e),s)}},Qs=o=>class extends o{async loadFont(t){return this.ir.br(t).then(()=>{const s=this.ir.maxGlyphDimensions;this.zn.Sr(s.width,s.height),this.na.resize(this.zn.cols,this.zn.rows),this.j.Mi(),this.Io.eo(),this.oa.eo()})}fontSize(t){if(!st.m(typeof t=="number"&&t>0,"Font size must be a positive number greater than 0.",{method:"fontSize",providedValue:t})||this.ir.fontSize===t)return;this.ir.wr(t);const s=this.ir.maxGlyphDimensions;this.zn.Sr(s.width,s.height),this.na.resize(this.zn.cols,this.zn.rows),this.j.Mi(),this.Io.eo(),this.oa.eo()}},$s=o=>class extends o{get frameCount(){return this.ha.Sn}set frameCount(t){this.ha.Sn=t}frameRate(t){return t===void 0?this.ha.Rn:this.ha.Tn(t,()=>this.aa())}noLoop(){this.ha.Fn()}loop(){this.ha.$n(()=>this.aa())}redraw(t=1){if(st.m(typeof t=="number"&&t>0&&Number.isInteger(t),"Redraw count must be a positive integer.",{method:"redraw",providedValue:t}))for(let s=0;s<t;s++)this.aa()}isLooping(){return this.ha.En}},te=o=>class extends o{constructor(...t){super(...t)}mouseClicked(t){this.Io.uo(t)}mousePressed(t){this.Io.fo(t)}mouseReleased(t){this.Io.do(t)}mouseMoved(t){this.Io.po(t)}mouseScrolled(t){this.Io.vo(t)}get mouse(){return this.Io.mo()}cursor(t){this.Io.so(t)}},se=o=>class extends o{constructor(...t){super(...t)}touchStarted(t){this.oa.Mh(t)}touchMoved(t){this.oa.po(t)}touchEnded(t){this.oa.xh(t)}touchCancelled(t){this.oa.Fh(t)}tap(t){this.oa.$h(t)}doubleTap(t){this.oa.Th(t)}longPress(t){this.oa.Ph(t)}swipe(t){this.oa.Eh(t)}pinch(t){this.oa.Rh(t)}rotateGesture(t){this.oa.Sh(t)}get touches(){return this.oa.Ch()}},ee=o=>class extends o{constructor(...t){super(...t)}keyPressed(t){this.ca.fo(t)}keyReleased(t){this.ca.do(t)}isKeyPressed(t){return this.ca.To(t)}get lastKeyPressed(){return this.ca.Eo()}get lastKeyReleased(){return this.ca.Ro()}get pressedKeys(){return this.ca.So()}get modifierState(){return this.ca.ko()}};class ie{constructor(t){a(this,"la"),a(this,"ua",new Map),a(this,"fa",[]),a(this,"da",new Map),a(this,"pa",new Map),this.la=t}async ga(t){for(const s of t){if(this.ua.has(s.name))return void console.warn(`[textmode.js] Plugin "${s.name}" is already installed.`);const e=this.va(s.name);try{await s.install(this.la,e)}catch(r){throw this.ma(s.name),r}this.ua.set(s.name,s),this.fa.push(s.name)}}async _a(t){const s=this.ua.get(t);if(!s)return;const e=this.va(t);s.uninstall&&await s.uninstall(this.la,e),this.ua.delete(t),this.fa.splice(this.fa.indexOf(t),1),this.ma(t)}ya(){this.wa(this.da)}ba(){this.wa(this.pa)}async Ca(){const t=[...this.ua.keys()];for(const s of t)await this._a(s)}va(t){return{renderer:this.la.j,font:this.la.ir,grid:this.la.zn,canvas:this.la.Pr,drawFramebuffer:this.la.na,asciiFramebuffer:this.la.Ma,registerPreDrawHook:s=>this.xa(this.da,t,s),registerPostDrawHook:s=>this.xa(this.pa,t,s)}}xa(t,s,e){const r=t.get(s)??new Set;return r.add(e),t.set(s,r),()=>{const i=t.get(s);i&&(i.delete(e),i.size===0&&t.delete(s))}}ma(t){this.da.delete(t),this.pa.delete(t)}wa(t){for(const s of this.fa){const e=t.get(s);e&&e.forEach(r=>r())}}}const zt=`#version 300 es
in vec2 A0;in vec2 A1;out vec2 v_uv;void main(){v_uv=A1;gl_Position=vec4(A0,0.,1.);}`;class $t{constructor(){a(this,"Fa",new Map),a(this,"$a",[]),a(this,"Ta",0),a(this,"Pa",0),a(this,"Ea")}get Ra(){return this.Ta}get Sa(){if(this.Ta===0)return 0;let t=0;for(const s of this.$a){const e=this.Fa.get(s);e&&(t+=Math.min(1,Math.max(0,e.progress))*e.weight)}return Math.min(1,t/this.Ta)}ka(t){this.Ea=t}za(t,s=1){const e=`phase-${this.$a.length+1}-${Date.now()}`,r={id:e,label:t,weight:Math.max(.001,s),progress:0,status:"running"};return this.Fa.set(e,r),this.$a.push(e),this.Ta+=r.weight,e}Ia(t,s){const e=this.Fa.get(t);if(!e)return;e.progress=Math.max(0,Math.min(1,s)),e.status=e.progress>=1?"complete":"running";const r=this.Sa;Math.abs(r-this.Pa)>.001&&(this.Pa=r,this.Ea&&this.Ea(r))}Oa(t){const s=this.Fa.get(t);s&&(s.progress=1,s.status="complete",this.Ia(t,1))}La(t){const s=this.Fa.get(t);s&&(s.status="failed")}Da(){return this.$a.map(t=>{const s=this.Fa.get(t);return s?{id:s.id,label:s.label,weight:s.weight,progress:s.progress,status:s.status}:{id:t,label:t,weight:1,progress:0,status:"pending"}})}}class ts{constructor(t="active"){a(this,"Ba"),a(this,"Ha",""),a(this,"Ga",""),this.Ba=t}get Na(){return this.Ba}get Xa(){return this.Ba!=="disabled"}get Ya(){return this.Ba==="active"||this.Ba==="transitioning"||this.Ba==="error"}get Ka(){return this.Ha}get ja(){return this.Ga}Za(){this.Ba!=="done"&&this.Ba!=="transitioning"||(this.Ba="active")}Wa(){this.Ba!=="disabled"&&(this.Ba="done")}qa(){this.Ba!=="disabled"&&(this.Ba="transitioning")}Va(){this.Ba==="transitioning"&&(this.Ba="done")}Qa(t){this.Ba!=="disabled"&&(this.Ba="error",t instanceof Error?(this.Ha=t.message,this.Ga=t.stack||""):(this.Ha=t,this.Ga=""))}Ja(){this.Ba="disabled"}}class ss{constructor(t,s){a(this,"tc",0),a(this,"sc",1),a(this,"ec"),a(this,"rc"),this.ec=t,this.rc=s}get nc(){return this.sc}get oc(){return this.sc<1}Mn(){this.ec!=="none"&&this.rc>0&&(this.tc=performance.now())}st(){if(this.ec==="none"||this.rc===0)return this.sc=1,!1;const t=performance.now()-this.tc,s=Math.min(1,t/this.rc);return s>=1?(this.sc=0,!0):(this.sc=1-s,!1)}Vs(){this.sc=1,this.tc=0}}function Ft(o,t){const s=o.tone??"auto";let e="dark";return s==="light"||s==="dark"?e=s:t&&(e=function(r){if(!r)return 0;const[i,h,n]=r.map(c=>c/255),l=c=>c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4);return .2126*l(i)+.7152*l(h)+.0722*l(n)}(t)>.5?"light":"dark"),{mode:e,background:t,textColor:e==="light"?"#1A1A1A":"#F8F8F8",subtleColor:e==="light"?"#4A4A4A":"#C0C0C0"}}function es(o){return o.mode==="light"?["#E91E63","#9C27B0","#FF6F00"]:["#8EF9F3","#F15BB5","#FF9B71"]}function is(o,t){return o.length?o.map(s=>t.color(s)):[t.color("#FFFFFF")]}const re=({textmodifier:o,grid:t,progress:s,frameCount:e,message:r,palette:i,theme:h,phases:n,transitionOpacity:l,isError:c,errorMessage:u})=>{const d="|/-\\",g=Math.floor(e/6)%4,f=o.color(h.textColor),m=Math.floor(255*l),p=o.color(f.r,f.g,f.b,m);if(o.charColor(p),o.cellColor(0,0,0,0),c){const v=o.color(h.mode==="light"?"#D32F2F":"#FF6B6B",m);o.charColor(v),o.push(),o.translate(0,-2,0),o.char("X"),o.rect(1,1),o.pop();const A="SETUP ERROR",E=-Math.floor(A.length/2);o.push(),o.translate(E,0,0);for(const y of A)o.char(y),o.rect(1,1),o.translateX(1);if(o.pop(),u){const y=o.color(h.subtleColor),R=o.color(y.r,y.g,y.b,m);o.charColor(R);const b=Math.floor(.8*t.cols),T=u.split(" "),P=[];let x="";for(const M of T)(x+" "+M).length<=b?x=x?x+" "+M:M:(x&&P.push(x),x=M);x&&P.push(x);const I=P.slice(0,3);P.length>3&&(I[2]=I[2].substring(0,b-3)+"..."),I.forEach((M,w)=>{const C=-Math.floor(M.length/2);o.push(),o.translate(C,3+w,0);for(const F of M)o.char(F),o.rect(1,1),o.translateX(1);o.pop()})}return}if(o.push(),o.translate(0,0,0),o.char(d[g]),o.rect(1,1),o.pop(),s>0||n.some(v=>v.status!=="pending")){const v=Math.max(6,Math.floor(.6*t.cols)),A=-Math.floor(v/2),E=Math.floor(v*s),y=i.length?i:[o.color("#FFFFFF")];o.push(),o.translate(A,3,0);for(let R=0;R<v;R++){const b=R<E?"*":".",T=y[R%y.length],P=o.color(T.r,T.g,T.b,m);o.charColor(P),o.char(b),o.rect(1,1),o.translateX(1)}o.pop()}if(r){const v=o.color(h.subtleColor),A=o.color(v.r,v.g,v.b,m);o.charColor(A);const E=-Math.floor(r.toUpperCase().length/2);o.push(),o.translate(E,5,0);for(const y of r.toUpperCase())o.char(y),o.rect(1,1),o.translateX(1);o.pop()}},he={message:"loading...",tone:"auto",transition:"fade",transitionDuration:500};class oe{constructor(t,s,e){this.hc=t,this.id=s,this.label=e}report(t){this.hc.Ia(this.id,t)}complete(){this.hc.Oa(this.id)}fail(t){this.hc.La(this.id)}async track(t){try{const s=typeof t=="function"?await t():await t;return this.complete(),s}catch(s){throw this.fail(),s}}}class rs{constructor(t,s,e){a(this,"la"),a(this,"l"),a(this,"ac"),a(this,"hc"),a(this,"cc"),a(this,"lc"),a(this,"uc"),a(this,"fc"),a(this,"dc"),a(this,"gc"),a(this,"j"),a(this,"vc",[]),a(this,"mc"),a(this,"_c",performance.now()),a(this,"yc",0),a(this,"wc",!1),a(this,"bc",!1),a(this,"Fc"),this.la=t,this.l={...he,...s??{}},this.ac=new ts("active"),this.hc=new $t,this.cc=new ss(this.l.transition,this.l.transitionDuration),this.lc=new Vt(60),this.mc=Ft(this.l,e);const r=es(this.mc);this.vc=is(r,this.la),this.j=this.Cc(),this.hc.ka(i=>{i>=.999&&this.Wa()})}async _r(t){if(this.bc)return;const s=this.la.j,e=this.la.Pr;this.uc=new It(s,16),await this.uc._r(t);const r=this.uc.maxGlyphDimensions;this.fc=new Kt(e.canvas,r.width,r.height),this.dc=s.bi(this.fc.cols,this.fc.rows,3),this.gc=s.bi(this.fc.width,this.fc.height,1),this.bc=!0}get Ya(){return this.ac.Ya&&this.wc}Mn(){this.wc||(this.wc=!0,this._c=performance.now(),this.yc=0,this.lc.Mn(()=>this.Mc()))}xn(){this.wc&&(this.wc=!1,this.lc.xn())}Nr(){this.bc&&(this.fc.Vs(),this.dc.resize(this.fc.cols,this.fc.rows),this.gc.resize(this.fc.width,this.fc.height))}D(){this.xn(),this.bc&&(this.uc.D(),this.dc.D(),this.gc.D(),this.bc=!1)}get progress(){return this.hc.Sa}message(t){return typeof t=="string"&&(this.l.message=t),this.l.message}addPhase(t,s=1){this.ac.Za();const e=this.hc.za(t,s);return new oe(this.hc,e,t)}Wa(){this.l.transition!=="none"&&this.l.transitionDuration>0?(this.ac.qa(),this.cc.Mn()):(this.ac.Wa(),this.xn(),this.xc())}xc(){this.Fc&&this.Fc()}$c(t){this.Fc=t}error(t){this.ac.Qa(t)}Mc(){if(this.ac.Ya){if(this.yc++,this.ac.Na==="transitioning"&&this.cc.st())return this.ac.Va(),this.xc(),void this.xn();this.Tc()}}Tc(){if(!this.bc)return;const t=this.dc,s=this.uc,e=this.fc,r=this.gc,i=this.la.j,h=this.la.Pr,n=this.la.Pc,l=this.la.Ec;i.state.Zt(),t.begin(),this.la.clear(),this.la.push();try{const c={textmodifier:this.la,grid:e,progress:this.progress,elapsedMs:performance.now()-this._c,frameCount:this.yc,message:this.l.message,palette:this.vc,theme:this.mc,phases:this.hc.Da(),transitionOpacity:this.cc.nc,isError:this.ac.Na==="error",errorMessage:this.ac.Ka||void 0,errorDetails:this.ac.ja||void 0};this.j(c)}finally{this.la.pop()}t.end(),r.begin(),i.ai(n),n.I({U0:s.fontFramebuffer,U1:[s.textureColumns,s.textureRows],U2:t.textures[0],U3:t.textures[1],U4:t.textures[2],U5:[e.cols,e.rows],U6:[r.width,r.height],U7:i.state.canvasBackgroundColor}),i.pi(0,0,h.width,h.height),r.end(),i.me(...i.state.canvasBackgroundColor),i.ai(l),l.I({U8:r.textures[0],U9:[r.width,r.height],Ua:[e.offsetX,e.offsetY],Ub:[e.width,e.height]}),i.pi(e.offsetX,e.offsetY,e.width,e.height)}Rc(t){this.mc=Ft(this.l,t)}Cc(){const t=this.l.renderer||re;return s=>{t(s),this.Sc(s)}}Sc(t){const{textmodifier:s,grid:e,frameCount:r,theme:i,transitionOpacity:h}=t,n=[116,101,120,116,109,111,100,101,46,106,115].map(d=>String.fromCharCode(d)).join(""),l=(e.rows+1>>1)-2,c=2-(e.cols+1>>1),u=i.mode==="light"?[[233,30,99],[156,39,176],[255,111,0]]:[[142,249,243],[241,91,181],[255,155,113]];s.push(),s.translate(c,l,0);for(let d=0;d<n.length;d++){const g=n[d],f=Math.floor(.1*r+.5*d)%u.length,[m,p,v]=u[f],A=Math.floor(255*h),E=s.color(m,p,v,A);s.charColor(E),s.char(g),s.point(),s.translateX(1)}s.pop()}}class ne extends function(t,...s){return s.reduce((e,r)=>r(e),t)}(class{},Js,Qs,$s,te,se,ee){constructor(t={}){super(),a(this,"j"),a(this,"ir"),a(this,"Pr"),a(this,"zn"),a(this,"ha"),a(this,"Io"),a(this,"oa"),a(this,"ca"),a(this,"kc"),a(this,"na"),a(this,"Pc"),a(this,"Ma"),a(this,"Ec"),a(this,"zc"),a(this,"Ic",!1),a(this,"Oc",!1),a(this,"Lc",!1),a(this,"Dc",!1),a(this,"Bc",()=>{}),a(this,"Hc",()=>{}),a(this,"Gc",()=>{}),a(this,"Nc"),a(this,"Xc"),a(this,"zr",!1),a(this,"Yc"),this.zc=new ie(this),this.zr=t.overlay??!1,this.Pr=new Ks(t),this.j=new Fs(this.Pr.Xr()),this.ir=new It(this.j,t.fontSize??16),this.ha=new Vt(t.frameRate??60),this.kc=new rs(this,t.loadingScreen,this.Pr.Gr()),this.kc.$c(()=>{this.ha.Sn=0,this.Dc=!0}),this.Io=new qt(this.Pr),this.oa=new Qt(this.Pr,this.Io),this.ca=new Jt,this.Pc=this.j.ci(zt,`#version 300 es
precision highp float;uniform sampler2D U0;uniform vec2 U1;uniform sampler2D U3;uniform sampler2D U4;uniform sampler2D U2;uniform vec2 U5;uniform vec2 U6;uniform vec4 U7;in vec2 v_uv;out vec4 fragColor;mat2 A(float B){float C=sin(B);float D=cos(B);return mat2(D,-C,C,D);}void main(){vec2 E=gl_FragCoord.xy/U6;vec2 F=E*U5;vec2 G=floor(F);vec2 H=(G+0.5)/U5;vec4 I=texture(U3,H);vec4 J=texture(U4,H);vec4 K=texture(U2,H);int L=int(K.b*255.+0.5);bool M=(L&1)!=0;bool N=(L&2)!=0;bool O=(L&4)!=0;int P=int(K.r*255.+0.5)+int(K.g*255.+0.5)*256;int Q=int(U1.x);int R=P/Q;int S=P-(R*Q);float T=(U1.y-1.)-float(R);vec2 U=1./U1;vec2 V=vec2(float(S),T)*U;vec2 W=V+U;float X=-K.a*360.*0.017453292;vec2 Y=fract(F)-0.5f;vec2 Z=vec2(N?-1.:1.,O?-1.:1.);Y*=Z;Y=A(X)*Y+0.5;vec2 a=V+clamp(Y,0.,1.)*U;const float b=0.0001;if(any(lessThan(a,V-b))||any(greaterThan(a,W+b))){fragColor=M?I:J;return;}vec4 c=texture(U0,a);if(M)c.rgb=mix(c.rgb,1.-c.rgb,float(M));vec4 d=mix(U7,J,J.a);fragColor=mix(d,I,c);}`),this.kc.Mn(),this.Kc(t)}async Kc(t){await Promise.all([this.ir._r(t.fontSource),this.kc._r(t.fontSource)]);const s=this.ir.maxGlyphDimensions;this.zn=new Kt(this.Pr.canvas,s.width,s.height),this.Io._r(this.zn),this.oa._r(this.zn),this.na=this.j.bi(this.zn.cols,this.zn.rows,3),this.Ma=this.j.bi(this.zn.width,this.zn.height,1),this.zr&&(this.Yc=W.pn(this.j,this.Pr.targetCanvas,this.zn.cols,this.zn.rows,e=>this.ir.er(e))),this.Ec=this.j.ci(zt,`#version 300 es
precision highp float;uniform sampler2D U8;uniform vec2 U9;uniform vec2 Ua;uniform vec2 Ub;in vec2 v_uv;out vec4 fragColor;void main(){vec2 A=gl_FragCoord.xy-Ua;vec2 B=A*(U9/Ub);vec2 C=(floor(B)+0.5)/U9;fragColor=texture(U8,C);}`),this.jc(),this.ha.Mn(()=>this.aa()),await this.zc.ga(t.plugins??[]);try{await this.Bc(),this.kc.Wa()}catch(e){console.error("Error during setup:",e),this.kc.error(e)}}jc(){this.Nc=()=>{this.zr&&this.resizeCanvas(this.Pr.targetCanvas.width,this.Pr.targetCanvas.height),this.Gc()},window.addEventListener("resize",this.Nc),this.Io.io(),this.oa.io(),this.ca.io(),window.addEventListener("blur",()=>{this.ca.zo()}),this.zr&&(this.Xc=new ResizeObserver(()=>{this.resizeCanvas(this.Pr.targetCanvas.width,this.Pr.targetCanvas.height)}),this.Xc.observe(this.Pr.targetCanvas))}aa(){if(!this.kc.Ya&&this.Dc){this.Oc=!0;try{this.ha.Pn(),this.ha.kn(),this.zr&&_t(this.j.context,this.Yc.texture,this.Pr.targetCanvas),this.zc.ya(),this.j.state.Zt(),this.na.begin(),this.Hc(),this.na.end(),this.Ma.begin(),this.j.ai(this.Pc),this.Pc.I({U0:this.ir.fontFramebuffer,U1:[this.ir.textureColumns,this.ir.textureRows],U2:this.na.textures[0],U3:this.na.textures[1],U4:this.na.textures[2],U5:[this.zn.cols,this.zn.rows],U6:[this.Ma.width,this.Ma.height],U7:this.j.state.canvasBackgroundColor}),this.j.pi(0,0,this.Pr.width,this.Pr.height),this.Ma.end(),this.j.me(...this.j.state.canvasBackgroundColor),this.j.ai(this.Ec),this.Ec.I({U8:this.Ma.textures[0],U9:[this.Ma.width,this.Ma.height],Ua:[this.zn.offsetX,this.zn.offsetY],Ub:[this.zn.width,this.zn.height]}),this.j.pi(this.zn.offsetX,this.zn.offsetY,this.zn.width,this.zn.height),this.zc.ba()}finally{this.Oc=!1,this.Ic&&!this.Lc&&this.Zc()}}}resizeCanvas(t,s){this.Pr.Nr(t,s),this.kc.Rc(this.Pr.Gr()),this.zn.Vs(),this.kc.Nr(),this.na.resize(this.zn.cols,this.zn.rows),this.Ma.resize(this.zn.width,this.zn.height),this.j.Mi(),this.Io.eo(),this.oa.eo(),this.aa()}destroy(){this.Lc||this.Ic||(this.Ic=!0,this.ha.Fn(),this.Oc||this.Zc())}Zc(){var t,s;this.Ic=!1,this.kc.D(),this.zc.Ca(),window.removeEventListener("resize",this.Nc),(t=this.Xc)==null||t.disconnect(),this.Io.lo(),this.oa.lo(),this.ca.lo(),this.na.D(),this.Pc.D(),this.ir.D(),this.j.D(),this.Ma.D(),this.Ec.D(),(s=this.Yc)==null||s.D(),this.Pr.D(),this.Lc=!0}setup(t){this.Bc=t}draw(t){this.Hc=t}windowResized(t){this.Gc=t}get grid(){return this.zn}get font(){return this.ir}get width(){return this.Pr.width}get height(){return this.Pr.height}get canvas(){return this.Pr.canvas}get drawFramebuffer(){return this.na}get isDisposed(){return this.Lc}get overlay(){return this.Yc}get loading(){return this.kc}}class Bt{constructor(){}static create(t={}){return new ne(t)}static setErrorLevel(t){st._(t)}static get version(){return"0.6.0-beta.2"}}Object.freeze(Object.defineProperty({__proto__:null,LoadingPhaseTracker:$t,LoadingScreenManager:rs,LoadingScreenStateMachine:ts,LoadingScreenTransition:ss,resolveColorInputs:is,resolveDefaultPalette:es,resolveTheme:Ft},Symbol.toStringTag,{value:"Module"}));Object.freeze(Object.defineProperty({__proto__:null,TextmodeFont:It,TextmodeImage:W,TextmodeVideo:ft},Symbol.toStringTag,{value:"Module"}));Object.freeze(Object.defineProperty({__proto__:null,keyboard:Vs,mouse:Zs,touch:qs},Symbol.toStringTag,{value:"Module"}));const ae=(o,t)=>{const s=o.split(" "),e=[];let r="";return s.forEach(i=>{const h=r.length>0?`${r} ${i}`:i;h.length>t?r.length>0?(e.push(r),r=i):e.push(i):r=h}),r.length>0&&e.push(r),e},ot="textmode.js",ce="A creative coding library for building dynamic ASCII art and textmode graphics with real-time* rendering",X=[60,90,120],bt=[0,180,180],Y=[0,140,200],Tt=[0,200,255],j=[0,100,160],xt=[0,160,220],H=[80,100,130],Rt=[0,180,200];function ue(o,t,s,e={}){if(!Bt)throw new Error("textmode.js library not loaded");const i=(e.mode??"hero")==="hero",h=Bt.create({canvas:o,width:t,height:s,fontSize:16,frameRate:60,fontSource:"/Bescii-Mono.woff"});let n=0;const l="â–‘â–’â–“â–ˆâ–€â–„",c=()=>{const g=Math.floor(h.grid.cols*.85),f=Math.max(15,Math.min(g,50));return ae(ce,f)};let u=[];h.setup(()=>{h.background(0,0,0,0),i&&(u=c())}),h.draw(()=>{h.background(0,0,0,0),n+=.04;for(let g=0;g<h.grid.rows;g++)for(let f=0;f<h.grid.cols;f++){const m=f-h.grid.cols/2,p=g-h.grid.rows/2,v=Math.sqrt(m*m+p*p),A=Math.sin(v*.3-n*2)*.5+.5,E=Math.sin(f*.2+n)*.5+.5,y=Math.sin(g*.2-n*.7)*.5+.5,R=(A+E+y)/3,b=Math.floor(X[0]+(bt[0]-X[0])*R),T=Math.floor(X[1]+(bt[1]-X[1])*R),P=Math.floor(X[2]+(bt[2]-X[2])*R),x=Math.floor(R*(l.length-1)),I=l[x],M=f-h.grid.cols/2,w=g-h.grid.rows/2;h.push(),h.translate(M+1,w,0),h.char(I),h.charColor(b,T,P,255),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}if(i){u.length===0&&(u=c()),Math.max(2,Math.floor(h.grid.cols*.05));const g=0,f=Math.min(2,h.grid.cols-ot.length-2)+1,m=Math.min(g,h.grid.rows-u.length-6),p=m+4,v=Math.max(...u.map(w=>w.length)),A=ot.length+2,E=Math.max(A,v+2),y={topLeft:"â”Œ",topRight:"â”",bottomLeft:"â””",bottomRight:"â”˜",middleLeft:"â”œ",horizontal:"â”€",vertical:"â”‚",bottomJoin:"â”´"},R=n*1.5,b=Math.sin(R)*.5+.5,T=Math.floor(j[0]+(xt[0]-j[0])*b),P=Math.floor(j[1]+(xt[1]-j[1])*b),x=Math.floor(j[2]+(xt[2]-j[2])*b),I=Math.floor(200+b*55);for(let w=0;w<A;w++){let C=y.horizontal;w===0&&(C=y.topLeft),w===A-1&&(C=y.topRight);const F=f-1+w-h.grid.cols/2,B=m+1-h.grid.rows/2;h.push(),h.translate(F,B,0),h.char(C),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}{const w=f-1-h.grid.cols/2,C=m+2-h.grid.rows/2;h.push(),h.translate(w,C,0),h.char(y.vertical),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}{const w=f+A-2-h.grid.cols/2,C=m+2-h.grid.rows/2;h.push(),h.translate(w,C,0),h.char(y.vertical),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}for(let w=0;w<ot.length;w++){const C=ot[w],F=n*2.2+w*.35,B=Math.sin(F)*.5+.5,dt=Math.floor(Y[0]+(Tt[0]-Y[0])*B),gt=Math.floor(Y[1]+(Tt[1]-Y[1])*B),pt=Math.floor(Y[2]+(Tt[2]-Y[2])*B),_=f+w-h.grid.cols/2,At=m+2-h.grid.rows/2;h.push(),h.translate(_,At,0),h.char(C),h.charColor(dt,gt,pt,255),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}for(let w=0;w<E;w++){let C=y.horizontal;w===0?C=y.middleLeft:w===A-1?C=y.bottomJoin:w===E-1&&(C=y.topRight);const F=f-1+w-h.grid.cols/2,B=m+3-h.grid.rows/2;h.push(),h.translate(F,B,0),h.char(C),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}const M=E;u.length+1;for(let w=0;w<M;w++){let C=y.horizontal;w===0&&(C=y.bottomLeft),w===M-1&&(C=y.bottomRight);const F=f-1+w-h.grid.cols/2,B=p+u.length-h.grid.rows/2;h.push(),h.translate(F,B,0),h.char(C),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}for(let w=0;w<u.length;w++){{const C=f-1-h.grid.cols/2,F=p+w-h.grid.rows/2;h.push(),h.translate(C,F,0),h.char(y.vertical),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}{const C=f+v-h.grid.cols/2,F=p+w-h.grid.rows/2;h.push(),h.translate(C,F,0),h.char(y.vertical),h.charColor(T,P,x,I),h.cellColor(0,0,0,0),h.rect(1,1),h.pop()}}u.forEach((w,C)=>{for(let F=0;F<v;F++){const B=f+F-h.grid.cols/2,dt=p+C-h.grid.rows/2;if(h.push(),h.translate(B,dt,0),F<w.length){const gt=w[F],pt=n*1.8+F*.25+C*.8,_=Math.sin(pt)*.5+.5,At=Math.floor(H[0]+(Rt[0]-H[0])*_),hs=Math.floor(H[1]+(Rt[1]-H[1])*_),os=Math.floor(H[2]+(Rt[2]-H[2])*_),ns=Math.floor(200+_*55);h.char(gt),h.charColor(At,hs,os,ns),h.cellColor(0,0,0,0)}else h.char(" "),h.charColor(0,0,0,0),h.cellColor(0,0,0,0);h.rect(1,1),h.pop()}})}});const d=(g,f)=>{o.width=g,o.height=f,h.resizeCanvas(g,f),i&&(u=c())};return h.windowResized(()=>{if(o&&o.parentElement){const g=o.parentElement.clientWidth,f=o.parentElement.clientHeight;d(g,f)}}),{tm:h,resize:d}}export{ue as createHeroWaveSketch};
